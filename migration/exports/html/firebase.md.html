<p>Today we&#39;re going to learn how to use Firebase as a database for a simple website using JavaScript!</p>
<p>Right now, this is what my fantastic website looks like</p>
<blockquote>
<p><img src="/public/images/blog/firebase/fantastic_website.png" alt="This is my fantastic website!"></p>
</blockquote>
<p>What I want to do is include a guestbook, a way for people who visit the site to leave a wonderful message for those who follow in their steps. So, in the end, I should have a website that looks something like this.</p>
<blockquote>
<p><img src="/public/images/blog/firebase/fantastic_final.png" alt="website with textbox"></p>
</blockquote>
<p>I don&#39;t have any CSS in my website but that&#39;s only so the implemented feature is blatantly obvious.</p>
<p>The first thing you&#39;ll need for this is a website and a url you can access it with. I&#39;ll be using my fantastic website which you can fork <a href="https://repl.it/@yevbar/My-Fantastic-Website">here</a>. Once you have those two things, continue along to the following steps!</p>
<p>We need to first set up Firebase before we can use it in our website so let&#39;s go and do that. If you&#39;re interested in learning a bit more about Firebase, check out their website at <a href="https://firebase.google.com/">firebase.google.com</a>.</p>
<p>Once you&#39;re ready, go over to <a href="https://console.firebase.google.com/">console.firebase.google.com</a>. If you&#39;re not already logged into a Google account, it&#39;ll prompt you to do so.</p>
<p>As soon as you&#39;re logged in, you&#39;ll be greeted with your Firebase Console</p>
<p><img src="/public/images/blog/firebase/console.png" alt="Firebase website"></p>
<p>Go ahead and &quot;Add Project&quot; then put whatever you like for the name of your application</p>
<p><img src="/public/images/blog/firebase/i_love_replit.png" alt="project on firebase"></p>
<p>Select &quot;Create Project&quot; and after a few seconds you&#39;ll see the dashboard for the app you just created</p>
<p><img src="/public/images/blog/firebase/dashboard.png" alt="firebase dashboard"></p>
<p>At this point, we have an application but it&#39;s not fully configured yet so let&#39;s change that. Under <strong>Develop</strong>, select <strong>Authentication</strong></p>
<p><img src="/public/images/blog/firebase/authentication.png" alt="firebase authentication"></p>
<p>Next, go to the <strong>Sign-In method</strong> tab</p>
<p><img src="/public/images/blog/firebase/signin_method.png" alt="firebase signin"></p>
<p>Scroll down to the section with <strong>Authorized domains</strong> and add the url for the hosted repl</p>
<p><img src="/public/images/blog/firebase/domain.png" alt="firebase domain"></p>
<p>The last thing we need to do to configure our database is actually set the permissions for an app to access/write our database. To do that, go over to <strong>Database</strong></p>
<p><img src="/public/images/blog/firebase/database.png" alt="firebase database"></p>
<p>Scroll down to <strong>Realtime Database</strong> and &quot;Create database&quot;</p>
<p><img src="/public/images/blog/firebase/realtime.png" alt="firebase realtime"></p>
<p>It doesn&#39;t really matter what rules you initialize with since we&#39;ll be setting those next. As soon as you create your database, you&#39;ll see a dashboard for that database. Click on &quot;Rules&quot; and, if needed, modify the JSON so that it&#39;s the following</p>
<pre><code class="language-javascript">{
  &quot;rules&quot;: {
    &quot;.read&quot;: true,
    &quot;.write&quot;: true
  }
}
</code></pre>
<p>What this means is that any user or app that is under the authorized domains can both read and modify our database. In my case with reviews on my website, I don&#39;t really mind, however, if you&#39;re making a website or project where security of information is important then do manage permissions accordingly. If you&#39;re looking to access the database from a server or such, check out how to <a href="https://firebase.google.com/docs/admin/setup">add the Firebase Admin SDK to your server</a> so that you can properly configure the rules for your app.</p>
<p>With that, we&#39;re ready to start using Firebase!</p>
<p>The first thing we&#39;ll need to put in our website are some dependencies. I&#39;ll be using JQuery to dynamically add comments as well as two Firebase libraries where one&#39;s to connect to Firebase and the other is to utilize the realtime database. Be sure to put these before any of your <code>&lt;script&gt;</code> elements</p>
<pre><code class="language-html">&lt;script src=&quot;https://code.jquery.com/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://www.gstatic.com/firebasejs/5.3.0/firebase-database.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>At the end of my <code>&lt;body&gt;</code> I put a <code>div</code> with the id &quot;comments&quot; and this is where my comments will go</p>
<pre><code class="language-html">&lt;body&gt;
  &lt;!-- Some other HTML... --&gt;
  &lt;div id=&quot;comments&quot;&gt;
  &lt;/div&gt;
&lt;/body&gt;
</code></pre>
<p>That&#39;s it for the HTML, now we can get working in our JavaScript file.</p>
<p>First, we&#39;ll put in our JQuery <code>ready</code> function so that the code only executes when the browser is ready</p>
<pre><code class="language-javascript">$(document).ready(function() {
   // This is where our code will go
});
</code></pre>
<p>We&#39;ve already configured the database but we need to actually initialize a database connection in our JavaScript so go back to the dashboard for your application and select <strong>Add Firebase to your web app</strong> so that you&#39;re prompted with a code snippet</p>
<p><img src="/public/images/blog/firebase/add.png" alt="firebase code snippet"></p>
<p>Copy the JavaScript that&#39;s between the <code>script</code> tags and paste it into your <code>ready</code> function so it looks something like this</p>
<pre><code class="language-javascript">$(document).ready(function() {
  // Initialize Firebase
  var config = {
    apiKey: &quot;AIzaSyDz8OrTtNBOZY2HliZ2-cmsPX8wi-4rGAQ&quot;,
    authDomain: &quot;i-love-replit.firebaseapp.com&quot;,
    databaseURL: &quot;https://i-love-replit.firebaseio.com&quot;,
    projectId: &quot;i-love-replit&quot;,
    storageBucket: &quot;i-love-replit.appspot.com&quot;,
    messagingSenderId: &quot;214072077152&quot;
  };
  firebase.initializeApp(config);
});
</code></pre>
<p>This just connects to Firebase, we&#39;ll want to connect to the Realtime Database and we can do so with the following</p>
<pre><code class="language-javascript">let guestBook = firebase.database().ref();
</code></pre>
<p>With the <code>guestBook</code> object, we can utilize the power of the realtime database (moohoohaha)</p>
<p>The first method I&#39;m going to define is a <code>signGuestbook</code> method so, whenever I have a name and comment for a review, I can append it on swiftly</p>
<pre><code class="language-javascript">function signGuestbook(name, comment) {
  $(&quot;#comments&quot;).append(&quot;&lt;p&gt;&lt;b&gt;&quot; + name + &quot;&lt;/b&gt;&lt;br/&gt;&quot; + comment + &quot;&lt;/p&gt;&quot;);
}
</code></pre>
<p>With that method defined, we&#39;re ready to receive objects in the database so let&#39;s create a listener for that</p>
<pre><code class="language-javascript">guestBook.on(&#39;child_added&#39;, function(guest) {
  // Code goes here
});
</code></pre>
<p>The way we can access the <code>guest</code>&#39;s data is by calling its <code>val()</code> function and, using our <code>signGuestbook</code> method, we can add reviews as we receive them</p>
<pre><code class="language-javascript">guestBook.on(&#39;child_added&#39;, function(guest) {
  if (guest.val().name &amp;&amp; guest.val().comment) {
      signGuestbook(guest.val().name,guest.val().comment);
  }
});
</code></pre>
<p>The reason for checking that the <code>name</code> and <code>comment</code> are truthy is so that our comment appending doesn&#39;t break.</p>
<p>So now that we&#39;re ready to receive guests and reviews, let&#39;s introduce a way to create them in the first place. To do that, I made a simple HTML form</p>
<pre><code class="language-html">&lt;form id=&quot;guestbook&quot;&gt;
      &lt;span&gt;Name:&lt;/span&gt;
      &lt;br/&gt;
      &lt;input type=&quot;text&quot; id=&quot;name&quot;&gt;
      &lt;br/&gt;
      &lt;span&gt;Comment:&lt;/span&gt;
      &lt;br/&gt;
      &lt;input type=&quot;text&quot; id=&quot;comment&quot;&gt;
      &lt;br/&gt;
      &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<p>To keep the page from reloading when I &quot;submit&quot;, I use JQuery</p>
<pre><code class="language-javascript">$(&#39;#guestbook&#39;).submit(function(event) {
    event.preventDefault();
});
</code></pre>
<p>When I submit my form, that means I&#39;m adding a review so let&#39;s add the given values to our database</p>
<pre><code class="language-javascript">$(&#39;#guestbook&#39;).submit(function(event) {
  event.preventDefault();
  // Add guest to guestbook
  guestBook.push({
    name: $(&#39;#name&#39;).val(),
    comment: $(&#39;#comment&#39;).val(),
  });
});
</code></pre>
<p>The reason we only add the review to Firebase and not call <code>signGuestbook</code> is because, when we add the review, it triggers the <code>child_added</code> listener so it gets appended from that.</p>
<p>For the sake of keeping things clean, I&#39;m going to clear the input elements and reset the focus</p>
<pre><code class="language-javascript">$(&#39;#guestbook&#39;).submit(function(event) {
  event.preventDefault();
  // Add guest to guestbook
  guestBook.push({
    name: $(&#39;#name&#39;).val(),
    comment: $(&#39;#comment&#39;).val(),
  });

  $(&#39;#name&#39;).val(&#39;&#39;);
  $(&#39;#comment&#39;).val(&#39;&#39;);
  $(&#39;#name&#39;).focus();
});
</code></pre>
<p>Go ahead and start adding your comments and you&#39;ll see your guestbook come to life! If you reload the tab or open in another browser, after a few seconds, you&#39;ll see all the previous reviews get appended even though we never made an explicit call to get old data!</p>
<p>The reason for that is, when we initialize our <code>guestBook</code> with the realtime database, it syncs up old data so that it&#39;s in the same state as it is on Firebase which makes thing convinient on our end.</p>
<p>The last topic to cover is a massive security flaw on our website called XSS. You can learn a lot from the <a href="https://www.owasp.org/index.php/XSS">OWASP page</a> but it&#39;s an attack where user generated code gets executed on another client&#39;s app.</p>
<p>As an example for something you can do right now, put the following as either a name or comment</p>
<pre><code class="language-html">&lt;script&gt;alert(1);&lt;/script&gt;
</code></pre>
<p>What this does is alert the browser which, albeit, is just annoying. However, I can run any javascript here which means I can do a lot more than just annoy you.</p>
<p>How do we solve this? The only thing we really need to do is HTML escape some characters and we can do that with JQuery</p>
<pre><code class="language-javascript">function signGuestbook(name, comment) {
  const review = document.createElement(&#39;p&#39;);
  review.textContent = comment;

  const name = document.createElement(&#39;p&#39;);
  const bold = document.createElement(&#39;b&#39;);
  bold.textContent = name;
  name.appendChild(bold);

  document.getElementById(&#39;comments&#39;).appendChild(name);
  document.getElementById(&#39;comments&#39;).appendChild(review);
}
</code></pre>
<p>And, with that, you have a functioning guestbook on your website!</p>
<p>If you have any questions or just want to say hi, feel free to shoot me an email at <a href="mailto:yev@repl.it">yev@repl.it</a> and till next time!</p>
