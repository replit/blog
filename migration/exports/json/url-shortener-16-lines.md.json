{"_id":"post-a98c4fdc-d4d2-40c4-9843-1f6e2b40fc8f","_type":"post","title":"A URL Shortener in 16 Lines of Code with Node.js and nanoexpress","slug":{"_type":"slug","current":"url-shortener-16-lines"},"body":[{"_key":"7e8abf682bbc","children":[{"_type":"span","marks":[],"text":"The Backstory","_key":"7e8abf682bbc0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"39ae315af368","children":[{"_type":"span","marks":[],"text":"In October of 2020, Meghan, our people person, messaged me asking if there was a professional-looking URL shortener. Over the next 48 hours, I created ","_key":"39ae315af3680"},{"_type":"span","marks":["032431b81d5a"],"text":"Replit.sh","_key":"39ae315af3681"},{"_type":"span","marks":[],"text":", a URL shortener for use by the Replit team and ","_key":"39ae315af3682"},{"_type":"span","marks":["8f531e28371e"],"text":"published it on Github","_key":"39ae315af3683"},{"_type":"span","marks":[],"text":" for anyone to use. For the past few days, I have been working on rewriting the entire system from the ground up and so it just made sense for me to make a tutorial on how it is done.","_key":"39ae315af3684"}],"markDefs":[{"_key":"032431b81d5a","_type":"link","href":"https://replit.sh"},{"_key":"8f531e28371e","_type":"link","href":"https://github.com/replit-discord/Replit.sh/tree/4ea4d708d3d970a63e7dcf980127510ee0bcda75"}],"_type":"block","style":"normal"},{"_type":"image","_sanityAsset":"image@https://blog.replit.com/images/url-shortener-tutorial/slack.png","_key":"6eae700df750"},{"_key":"3af819a3d381","children":[{"_type":"span","marks":[],"text":"The Tools Being Used","_key":"3af819a3d3810"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"db438721c2f1","children":[{"_type":"span","marks":[],"text":"To have a nice balance of simplicity and performance , I decided to use a Node.js repl and a library called nanoexpress, a library similar to express, but with some of the features removed and some pretty optimized code to have much lower latency and much higher throughput than regular express. Since nanoexpress doesn't include server rendering of pages and I want to keep this as simple as possible, links will have to be manually entered into ","_key":"db438721c2f10"},{"_type":"span","marks":["code"],"text":"links.json","_key":"db438721c2f11"},{"_type":"span","marks":[],"text":" and then loaded in every time you restart the program. Though it isn't a library, I am also going to be writing this as a ","_key":"db438721c2f12"},{"_type":"span","marks":["code"],"text":"module","_key":"db438721c2f13"},{"_type":"span","marks":[],"text":", since nanoexpress doesn't support the ","_key":"db438721c2f14"},{"_type":"span","marks":["code"],"text":"require()","_key":"db438721c2f15"},{"_type":"span","marks":[],"text":" function.","_key":"db438721c2f16"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d04e6abad0b2","children":[{"_type":"span","marks":[],"text":"Setting Up","_key":"d04e6abad0b20"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"663a55708bed","children":[{"_type":"span","marks":[],"text":"First things first, we need to get our project going. Create a new Node.js repl, and using the package manager, install nanoexpress.","_key":"663a55708bed0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"55a9993ba2f4","children":[{"_type":"span","_key":"55a9993ba2f40","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"image","_sanityAsset":"image@https://blog.replit.com/images/url-shortener-tutorial/package.png","_key":"6b8a2fd273e3"},{"_key":"f8bde1e01b4f","children":[{"_type":"span","marks":[],"text":"Next, we can set up our project as a ","_key":"f8bde1e01b4f0"},{"_type":"span","marks":["code"],"text":"node module","_key":"f8bde1e01b4f1"},{"_type":"span","marks":[],"text":" by adding ","_key":"f8bde1e01b4f2"},{"_type":"span","marks":["code"],"text":"\"type\": \"module\"","_key":"f8bde1e01b4f3"},{"_type":"span","marks":[],"text":" to our ","_key":"f8bde1e01b4f4"},{"_type":"span","marks":["code"],"text":"package.json","_key":"f8bde1e01b4f5"},{"_type":"span","marks":[],"text":". We do this because nanoexpress can't be used with the ","_key":"f8bde1e01b4f6"},{"_type":"span","marks":["code"],"text":"request()","_key":"f8bde1e01b4f7"},{"_type":"span","marks":[],"text":" function, and using ","_key":"f8bde1e01b4f8"},{"_type":"span","marks":["code"],"text":"import","_key":"f8bde1e01b4f9"},{"_type":"span","marks":[],"text":" requires your project to be set up as a ","_key":"f8bde1e01b4f10"},{"_type":"span","marks":["code"],"text":"node module","_key":"f8bde1e01b4f11"},{"_type":"span","marks":[],"text":". This will also require us to run this project with the ","_key":"f8bde1e01b4f12"},{"_type":"span","marks":["code"],"text":"--experimental-modules","_key":"f8bde1e01b4f13"},{"_type":"span","marks":[],"text":" tag enabled, which we'll set up in a little bit. In the end, that file should look something like this:","_key":"f8bde1e01b4f14"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"json","filename":"","code":"{\n  \"name\": \"simple-url-shortener\",\n  \"version\": \"1.0.0\",\n  \"type\": \"module\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\",\n  \"dependencies\": {\n    \"nanoexpress\": \"^3.0.2\"\n  }\n}\n","_key":"7475e300bdd6"},{"_key":"74bbb63f5655","children":[{"_type":"span","marks":[],"text":"Then, let's create a ","_key":"74bbb63f56550"},{"_type":"span","marks":["code"],"text":".replit","_key":"74bbb63f56551"},{"_type":"span","marks":[],"text":" file, which will allow us to run node with experimental modules, and paste this in:","_key":"74bbb63f56552"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"py","filename":"","code":"run = \"node index.js --experimental-modules\"\n","_key":"4ae56f174f43"},{"_key":"fbb3df84fe60","children":[{"_type":"span","marks":[],"text":"Last but certainly not least, let's get a ","_key":"fbb3df84fe600"},{"_type":"span","marks":["code"],"text":"Hello world!","_key":"fbb3df84fe601"},{"_type":"span","marks":[],"text":" program going in our ","_key":"fbb3df84fe602"},{"_type":"span","marks":["code"],"text":"index.js","_key":"fbb3df84fe603"},{"_type":"span","marks":[],"text":" like this:","_key":"fbb3df84fe604"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"js","filename":"","code":"import nanoexpress from 'nanoexpress'\n\nconst app = nanoexpress();\n\napp.get('/', async (req, res) => {\n    return res.send(\"Hello world!\");\n});\n\napp.listen(3000);\n","_key":"6a950f279aa8"},{"_key":"f18dc1818727","children":[{"_type":"span","marks":[],"text":"The JSON","_key":"f18dc18187270"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"51bbc49845ff","children":[{"_type":"span","marks":[],"text":"Now that we have a simple program going, it is time to move onto the JSON. Wanting to go the easy and straightforward route, I went for a single JSON object to be used, where each key is a URL id (think of ","_key":"51bbc49845ff0"},{"_type":"span","marks":["code"],"text":"2Q3gfQU","_key":"51bbc49845ff1"},{"_type":"span","marks":[],"text":" in ","_key":"51bbc49845ff2"},{"_type":"span","marks":["code"],"text":"https://bit.ly/2Q3gfQU","_key":"51bbc49845ff3"},{"_type":"span","marks":[],"text":") and the corresponding value is the URL. It is fast since it is a dictionary lookup, and no ","_key":"51bbc49845ff4"},{"_type":"span","marks":["code"],"text":"for","_key":"51bbc49845ff5"},{"_type":"span","marks":[],"text":" loops are involved. This is what the said JSON might look like:","_key":"51bbc49845ff6"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"json","filename":"","code":"{\n  \"piero\": \"https://piemadd.com/\",\n  \"replit\": \"https://replit.com/\",\n  \"mark\": \"https://replit.com/mark/\"\n}\n","_key":"b9978bc64e06"},{"_key":"5ed3158fd31c","children":[{"_type":"span","marks":[],"text":"To load this into our program, we'll use the standard js library and then the built-in JSON parsing. First, let's import the library and load the file, which I have ","_key":"5ed3158fd31c0"},{"_type":"span","marks":["code"],"text":"links.json","_key":"5ed3158fd31c1"},{"_type":"span","marks":[],"text":":","_key":"5ed3158fd31c2"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"js","filename":"","code":"import fs from 'fs';\n\nlet rawdata = fs.readFileSync('links.json');\nlet urls = JSON.parse(rawdata);\n","_key":"81e896f5ce3b"},{"_key":"6f175174feea","children":[{"_type":"span","marks":[],"text":"This will create a global dictionary named ","_key":"6f175174feea0"},{"_type":"span","marks":["code"],"text":"urls","_key":"6f175174feea1"},{"_type":"span","marks":[],"text":" containing our URLs. Since there is no use for the main page, I've decided to use it as an index of all the URLs. To do this, we simply have to replace ","_key":"6f175174feea2"},{"_type":"span","marks":["code"],"text":"\"Hello world!\"","_key":"6f175174feea3"},{"_type":"span","marks":[],"text":" with ","_key":"6f175174feea4"},{"_type":"span","marks":["code"],"text":"Object.keys(urls)","_key":"6f175174feea5"},{"_type":"span","marks":[],"text":" in our ","_key":"6f175174feea6"},{"_type":"span","marks":["code"],"text":"/","_key":"6f175174feea7"},{"_type":"span","marks":[],"text":" route. Handling specific URLs is not that much different. Our route will be for ","_key":"6f175174feea8"},{"_type":"span","marks":["code"],"text":"/:id","_key":"6f175174feea9"},{"_type":"span","marks":[],"text":", where ","_key":"6f175174feea10"},{"_type":"span","marks":["code"],"text":":id","_key":"6f175174feea11"},{"_type":"span","marks":[],"text":" means that anything after the ","_key":"6f175174feea12"},{"_type":"span","marks":["code"],"text":"/","_key":"6f175174feea13"},{"_type":"span","marks":[],"text":" will be passed on as ","_key":"6f175174feea14"},{"_type":"span","marks":["code"],"text":"req.params.id","_key":"6f175174feea15"},{"_type":"span","marks":[],"text":". We can then use that to find our corresponding URL and redirect the user, like this:","_key":"6f175174feea16"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"js","filename":"","code":"app.get('/:id', async (req, res) => {\n    let url = urls[req.params.id];\n    return res.redirect(url);\n})\n","_key":"6c8daf9301e1"},{"_key":"fc1db160e1e5","children":[{"_type":"span","marks":[],"text":"Now when a user goes to a URL like ","_key":"fc1db160e1e50"},{"_type":"span","marks":["code"],"text":"/piero","_key":"fc1db160e1e51"},{"_type":"span","marks":[],"text":" they get redirected to my website, ","_key":"fc1db160e1e52"},{"_type":"span","marks":["code"],"text":"piemadd.com","_key":"fc1db160e1e53"},{"_type":"span","marks":[],"text":".","_key":"fc1db160e1e54"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9178c6f813c5","children":[{"_type":"span","marks":[],"text":"In the end, our code should look like this:","_key":"9178c6f813c50"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"code","language":"js","filename":"","code":"import nanoexpress from 'nanoexpress';\nimport fs from 'fs';\n\nconst app = nanoexpress();\n\nlet urls = JSON.parse(fs.readFileSync('links.json'));\n\napp.get('/', async (req, res) => {\n    return res.send(Object.keys(urls));\n});\n\napp.get('/:id', async (req, res) => {\n    return res.redirect(urls[req.params.id]);\n});\n\napp.listen(3000);\n","_key":"763c9f34ba10"},{"_key":"106c139a1340","children":[{"_type":"span","marks":[],"text":"Closing Remarks","_key":"106c139a13400"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"83668e23ff97","children":[{"_type":"span","marks":[],"text":"At 16 lines in length, this URL shortener is impressive, in not only its abilities and size but its speed as well, though you need to add the links directly to the JSON file. If you would like to fork this project for your own use, check out ","_key":"83668e23ff970"},{"_type":"span","marks":["f711def66d63"],"text":"the repl here","_key":"83668e23ff971"},{"_type":"span","marks":[],"text":". Any constructive criticism is appreciated, and make sure to follow ","_key":"83668e23ff972"},{"_type":"span","marks":["1ecfc7b574c4"],"text":"our TikTok","_key":"83668e23ff973"},{"_type":"span","marks":[],"text":" for some tutorials on the very basics of programming on Replit.","_key":"83668e23ff974"}],"markDefs":[{"_key":"f711def66d63","_type":"link","href":"https://replit.com/@piemadd/simple-url-shortener"},{"_key":"1ecfc7b574c4","_type":"link","href":"https://tiktok.com/@replit"}],"_type":"block","style":"normal"}],"publishedAt":"2021-05-11T00:00:00.000Z"}