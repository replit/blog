{"_id":"post-503fb18c-c870-4425-9196-2926924ccf62","_type":"post","title":"SQLite, replified","slug":{"_type":"slug","current":"sqlite"},"body":[{"_key":"ce30a9db5c6a","children":[{"_type":"span","marks":[],"text":"SQLite is now a supported language ","_key":"ce30a9db5c6a0"},{"_type":"span","marks":["271798fec164"],"text":"on Repl.it","_key":"ce30a9db5c6a1"},{"_type":"span","marks":[],"text":"! Our SQLite support brings the entire SQLite command-line interface right into your workspace. Now you have a simple way to experiment, prototype, or refine your data model with SQL.","_key":"ce30a9db5c6a2"}],"markDefs":[{"_key":"271798fec164","_type":"link","href":"https://repl.it/languages/sqlite"}],"_type":"block","style":"normal"},{"_key":"b19acba4ed74","children":[{"_type":"span","marks":[],"text":"What is SQLite?","_key":"b19acba4ed740"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"0677e5d3b3bf","children":[{"_type":"span","marks":[],"text":"SQLite is an embedded database. It’s typically found in applications that need to store data without relying on an external database process, such as web browsers or small-scale websites. You could already use SQLite inside other languages on Repl.it, but now you can create a repl dedicated to SQL.","_key":"0677e5d3b3bf0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"944b37d583d8","children":[{"_type":"span","marks":[],"text":"SQLite comes with a powerful command-line interface. It has features that allow you to customize output, load and save files, and inspect your database.","_key":"944b37d583d80"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c1e21910fea8","children":[{"_type":"span","marks":[],"text":"By default, your database is only in memory. But since you have the full SQLite CLI, you can easily use the ","_key":"c1e21910fea80"},{"_type":"span","marks":["code"],"text":".save","_key":"c1e21910fea81"},{"_type":"span","marks":[],"text":" or ","_key":"c1e21910fea82"},{"_type":"span","marks":["code"],"text":".open","_key":"c1e21910fea83"},{"_type":"span","marks":[],"text":" commands to work with persistent, file-backed databases right in your workspace.","_key":"c1e21910fea84"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"89c81a444b77","children":[{"_type":"span","marks":["9c78402b3a12"],"text":"Try it out","_key":"89c81a444b770"},{"_type":"span","marks":[],"text":"!","_key":"89c81a444b771"}],"markDefs":[{"_key":"9c78402b3a12","_type":"link","href":"https://repl.it/languages/sqlite"}],"_type":"block","style":"normal"},{"_key":"cc39895770cf","children":[{"_type":"span","marks":[],"text":"How we did it","_key":"cc39895770cf0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"d33036ebe025","children":[{"_type":"span","marks":[],"text":"To bring this interface to Repl.it, we needed to add SQLite support to ","_key":"d33036ebe0250"},{"_type":"span","marks":["271b0caac276"],"text":"Prybar","_key":"d33036ebe0251"},{"_type":"span","marks":[],"text":", which is our open-source project to wrap language interpreters with a common interface.","_key":"d33036ebe0252"}],"markDefs":[{"_key":"271b0caac276","_type":"link","href":"https://github.com/replit/prybar"}],"_type":"block","style":"normal"},{"_key":"bf79bf930491","children":[{"_type":"span","marks":[],"text":"One of Prybar's goals is to provide a set of universal options for interacting with various interpreters, such as setting the prompt or making an interpreter start quietly without outputting any header or version information. These features are how we're able to customize interpreters for use within repls. Unfortunately, the SQLite CLI doesn’t have an option to suppress its version output when it starts up. So we had to add one!","_key":"bf79bf9304910"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c9b7ae205ac0","children":[{"_type":"span","marks":[],"text":"We did this by figuring out what system calls the CLI makes when it prints, using ","_key":"c9b7ae205ac00"},{"_type":"span","marks":["code"],"text":"LD_DEBUG","_key":"c9b7ae205ac01"},{"_type":"span","marks":[],"text":" and ","_key":"c9b7ae205ac02"},{"_type":"span","marks":["code"],"text":"ltrace","_key":"c9b7ae205ac03"},{"_type":"span","marks":[],"text":". We made our own shared library that intercepts the calls to print its version, and then, if Prybar is operating in quiet mode, we silently discard them instead of passing them on.","_key":"c9b7ae205ac04"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"3cb5f39c5d29","children":[{"_type":"span","marks":[],"text":"Whenever Prybar starts the SQLite CLI, it sets an environment variable called ","_key":"3cb5f39c5d290"},{"_type":"span","marks":["code"],"text":"LD_PRELOAD","_key":"3cb5f39c5d291"},{"_type":"span","marks":[],"text":" to make sure our library has precedence over the system’s. How does ","_key":"3cb5f39c5d292"},{"_type":"span","marks":["code"],"text":"LD_PRELOAD","_key":"3cb5f39c5d293"},{"_type":"span","marks":[],"text":" work? Here's an example, for those of you who might know a thing or two about C:","_key":"3cb5f39c5d294"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"f4d2a702e0f1","children":[{"_type":"span","marks":[],"text":"Notice that our ","_key":"f4d2a702e0f10"},{"_type":"span","marks":["code"],"text":"main.c","_key":"f4d2a702e0f11"},{"_type":"span","marks":[],"text":" only ever prints \"hello!\" but ","_key":"f4d2a702e0f12"},{"_type":"span","marks":["code"],"text":"LD_PRELOAD","_key":"f4d2a702e0f13"},{"_type":"span","marks":[],"text":" lets us append \" goodbye!\" to every message without modifying the existing code.","_key":"f4d2a702e0f14"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"embed","_id":"20deb962-2ce4-428a-b816-c3eeaafa3aae","url":"https://repl.it/@kochman/HelloGoodbye?lite=true","_key":"1d1e6e51f448"},{"_key":"d6779b6b25d5","children":[{"_type":"span","marks":[],"text":"This allows us to make our own customization by simply modifying the behavior of the existing binary—no forking or elaborate build process required. Take a look at ","_key":"d6779b6b25d50"},{"_type":"span","marks":["33e306b4604e"],"text":"how we did it with SQLite","_key":"d6779b6b25d51"},{"_type":"span","marks":[],"text":".","_key":"d6779b6b25d52"}],"markDefs":[{"_key":"33e306b4604e","_type":"link","href":"https://github.com/replit/prybar/commit/3fb14f2a46b628317d7dbb1c67d9cf078ee272c1"}],"_type":"block","style":"normal"},{"_key":"e490ed4646bd","children":[{"_type":"span","marks":[],"text":"We also created tests so we can ensure that our patch is always compatible with new versions of the SQLite CLI. If something that our patch relies on changes, our continuous integration tests will notify us so that we can fix it before deploying new versions of SQLite to the community.","_key":"e490ed4646bd0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4a78d6717121","children":[{"_type":"span","marks":[],"text":"For more information on Prybar, Polygott, and everything else that goes into supporting a new language, take a look at ","_key":"4a78d67171210"},{"_type":"span","marks":["5a87c4a0e5ff"],"text":"how we added support for Emacs Lisp","_key":"4a78d67171211"},{"_type":"span","marks":[],"text":".","_key":"4a78d67171212"}],"markDefs":[{"_key":"5a87c4a0e5ff","_type":"link","href":"https://repl.it/site/blog/elisp"}],"_type":"block","style":"normal"},{"_key":"1dc8d7359405","children":[{"_type":"span","marks":[],"text":"Don’t forget to ","_key":"1dc8d73594050"},{"_type":"span","marks":["2ce9c4ba74de"],"text":"give SQLite a try","_key":"1dc8d73594051"},{"_type":"span","marks":[],"text":" and ","_key":"1dc8d73594052"},{"_type":"span","marks":["e9dc8aef7fd3"],"text":"let us know what you think","_key":"1dc8d73594053"},{"_type":"span","marks":[],"text":"!","_key":"1dc8d73594054"}],"markDefs":[{"_key":"2ce9c4ba74de","_type":"link","href":"https://repl.it/languages/sqlite"},{"_key":"e9dc8aef7fd3","_type":"link","href":"https://repl.it/feedback/"}],"_type":"block","style":"normal"}],"publishedAt":"2019-08-02T17:00:00.000Z"}