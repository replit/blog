{"_id":"post-38a57b34-c4a2-4554-ab1f-564cf388119f","_type":"post","title":"Understanding Repl Resource Utilization","slug":{"_type":"slug","current":"repl-resources"},"body":[{"_key":"8c4f6c13bdce","children":[{"_type":"span","marks":[],"text":"Every computer on earth needs these three essential resources in some form:","_key":"8c4f6c13bdce0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b9b0dff1916c","children":[{"_type":"span","marks":[],"text":"Processor","_key":"b9b0dff1916c0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"8ad6d6c8c8ce","children":[{"_type":"span","marks":[],"text":"Memory","_key":"8ad6d6c8c8ce0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"00efde256875","children":[{"_type":"span","marks":[],"text":"Storage","_key":"00efde2568750"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"0044d6c806ce","children":[{"_type":"span","marks":[],"text":"The computers we provide for Replit users, or Repls, have access to a virtual CPU, an allocation of RAM, and a virtualized filesystem.","_key":"0044d6c806ce0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"617fbf3bf1e8","children":[{"_type":"span","marks":[],"text":"It’s important to understand resource utilization within the context of the software that you’re writing. To this end, we have started rolling out a new component in the file tree to make this more transparent and visible to all of our users.","_key":"617fbf3bf1e80"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4817a91751f3","children":[{"_type":"span","_key":"4817a91751f30","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9b30ad79a0d8","children":[{"_type":"span","marks":[],"text":"This component can help you figure out why your repl is running slowly or otherwise misbehaving.","_key":"9b30ad79a0d80"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"bb3dd250ac5a","children":[{"_type":"span","marks":[],"text":"But what do the numbers actually mean?","_key":"bb3dd250ac5a0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"795f36a95397","children":[{"_type":"span","marks":[],"text":"CPU","_key":"795f36a953970"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"e3a0d37cff01","children":[{"_type":"span","marks":[],"text":"There are many different types of processors, including GPUs, TPUs, microcontrollers, and more. These are specialized devices that serve distinct purposes, such as displaying graphics, machine learning, and powering smart devices.","_key":"e3a0d37cff010"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"939cab2a89cb","children":[{"_type":"span","marks":[],"text":"In addition to any other processors they may have, all modern personal computers have a CPU, or central processing unit. The CPU is responsible for executing instructions and running programs. In a sense, it is the brain of the computer.","_key":"939cab2a89cb0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"fbf9f1858bf7","children":[{"_type":"span","marks":[],"text":"Today, repls run on Google Cloud Platform and use Intel-compatible CPUs. For security and economic reasons, we don't give users access to the entire CPU. Instead, we host repls inside sandboxed Linux containers running on virtual machines that partition the CPU into virtual CPUs, or vCPUs.","_key":"fbf9f1858bf70"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d8793ed9419a","children":[{"_type":"span","marks":[],"text":"What does it mean to \"use\" the CPU?","_key":"d8793ed9419a0"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"be4ed89f16e2","children":[{"_type":"span","marks":[],"text":"The CPU operates by executing machine instructions via the ","_key":"be4ed89f16e20"},{"_type":"span","marks":["1b629086564c"],"text":"fetch-execute cycle","_key":"be4ed89f16e21"},{"_type":"span","marks":[],"text":".","_key":"be4ed89f16e22"}],"markDefs":[{"_key":"1b629086564c","_type":"link","href":"https://en.wikipedia.org/wiki/Instruction_cycle"}],"_type":"block","style":"normal"},{"_key":"6e0f8c10f911","children":[{"_type":"span","marks":[],"text":"Modern computers are highly complex and typically need to run more than one program at a time. To accomplish this, the computer runs an operating system which has exclusive control over how all of the applications on a computer share the CPU. The code within the OS that is responsible for allocating CPU time to user applications is known as the ","_key":"6e0f8c10f9110"},{"_type":"span","marks":["f652a17ee3dd"],"text":"process scheduler","_key":"6e0f8c10f9111"},{"_type":"span","marks":[],"text":".","_key":"6e0f8c10f9112"}],"markDefs":[{"_key":"f652a17ee3dd","_type":"link","href":"https://en.wikipedia.org/wiki/Completely_Fair_Scheduler"}],"_type":"block","style":"normal"},{"_key":"ffda6d16ed91","children":[{"_type":"span","marks":[],"text":"The details of process scheduling are complex, but the beauty of an operating system is that a user, you don't need to know how it all works under the hood. All you need to know to get started is that the program you're trying to run will get its fair share of the underlying processor, just like everyone else.","_key":"ffda6d16ed910"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"fe8861898308","children":[{"_type":"span","marks":[],"text":"Ok, so what's CPU \"utilization\"?","_key":"fe88618983080"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"f9022819a3a6","children":[{"_type":"span","marks":[],"text":"Linux tracks the total CPU time used by the entire system in nanoseconds in a file in the ","_key":"f9022819a3a60"},{"_type":"span","marks":["5db89e4d70f7"],"text":"sysfs pseudo-filesystem","_key":"f9022819a3a61"},{"_type":"span","marks":[],"text":". Try reading this file in a shell with ","_key":"f9022819a3a62"},{"_type":"span","marks":["code"],"text":"cat /sys/fs/cgroup/cpu/cpuacct.usage","_key":"f9022819a3a63"},{"_type":"span","marks":[],"text":".","_key":"f9022819a3a64"}],"markDefs":[{"_key":"5db89e4d70f7","_type":"link","href":"https://en.wikipedia.org/wiki/Sysfs"}],"_type":"block","style":"normal"},{"_key":"449619420a7c","children":[{"_type":"span","marks":[],"text":"The calculation for utilization simply takes the difference in time spent executing instructions by the CPU, or CPU time, over a given interval and divides it by the actual time that passed, or wall time, over that same interval.","_key":"449619420a7c0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b6f2aef99b14","children":[{"_type":"span","marks":[],"text":"You also need to divide this number by the CPU cores that are available on the system. This way, you won't have percentages over 100%, and if your CPU utilization is at 100%, it reflects your intuition that the system is as busy as it can possibly be.","_key":"b6f2aef99b140"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"ff949e48fe58","children":[{"_type":"span","marks":[],"text":"In addition to the resource monitoring component in the file tree, you can run programs such as ","_key":"ff949e48fe580"},{"_type":"span","marks":["code"],"text":"top","_key":"ff949e48fe581"},{"_type":"span","marks":[],"text":", ","_key":"ff949e48fe582"},{"_type":"span","marks":["code"],"text":"htop","_key":"ff949e48fe583"},{"_type":"span","marks":[],"text":", ","_key":"ff949e48fe584"},{"_type":"span","marks":["code"],"text":"mpstat","_key":"ff949e48fe585"},{"_type":"span","marks":[],"text":", and ","_key":"ff949e48fe586"},{"_type":"span","marks":["code"],"text":"sar","_key":"ff949e48fe587"},{"_type":"span","marks":[],"text":", all of which you can install in a Nix repl.","_key":"ff949e48fe588"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"61f09c64cded","children":[{"_type":"span","marks":[],"text":"How many CPU cores do I get on Replit?","_key":"61f09c64cded0"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"1d05567ede84","children":[{"_type":"span","marks":[],"text":"Free plans get 0.5 vCPUs allocated to their Repls. Hacker repls get 2 vCPUs, and Boosted repls are allocated 4 vCPUs.","_key":"1d05567ede840"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"8999c5ce60fb","children":[{"_type":"span","marks":[],"text":"If you find yourself running up against resource limits frequently as a free user, consider ","_key":"8999c5ce60fb0"},{"_type":"span","marks":["f25e05e87947"],"text":"purchasing Cycles","_key":"8999c5ce60fb1"},{"_type":"span","marks":[],"text":" and adding a Boost to your Repl for 8x more CPU to work with. If you're ready for Hacker, ","_key":"8999c5ce60fb2"},{"_type":"span","marks":["f3b4d08c8e7b"],"text":"subscribing to Hacker","_key":"8999c5ce60fb3"},{"_type":"span","marks":[],"text":" will instantly upgrade all your programs to have 4x as much CPU and you'll have 5 Boosts to add to any Repl.","_key":"8999c5ce60fb4"}],"markDefs":[{"_key":"f25e05e87947","_type":"link","href":"https://replit.com/cycles"},{"_key":"f3b4d08c8e7b","_type":"link","href":"https://replit.com/pricing"}],"_type":"block","style":"normal"},{"_key":"27bfd46abfa9","children":[{"_type":"span","marks":[],"text":"RAM","_key":"27bfd46abfa90"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"2b105edfa376","children":[{"_type":"span","marks":[],"text":"RAM stands for Random Access Memory.","_key":"2b105edfa3760"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"5d8cc23c8611","children":[{"_type":"span","marks":[],"text":"In the old days, you might have used a clunky device such as a ","_key":"5d8cc23c86110"},{"_type":"span","marks":["feb95e6d0afe"],"text":"magnetic drum","_key":"5d8cc23c86111"},{"_type":"span","marks":[],"text":", and it would have to literally spin a metal cylinder around in order to access a memory location. Today, we use lightweight sticks of ","_key":"5d8cc23c86112"},{"_type":"span","marks":["a7abb8ecc87f"],"text":"DRAM","_key":"5d8cc23c86113"},{"_type":"span","marks":[],"text":", or Dynamic RAM, that can read or write to any memory location instantly with a tiny electronic signal.","_key":"5d8cc23c86114"}],"markDefs":[{"_key":"feb95e6d0afe","_type":"link","href":"https://en.wikipedia.org/wiki/Drum_memory"},{"_key":"a7abb8ecc87f","_type":"link","href":"https://en.wikipedia.org/wiki/Dynamic_random-access_memory"}],"_type":"block","style":"normal"},{"_key":"da0b90505c7d","children":[{"_type":"span","marks":[],"text":"Memory is used to store any values that a program needs access to at runtime. For example, a file that is currently open in a text editor is stored in memory.","_key":"da0b90505c7d0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b85c8dc9aec8","children":[{"_type":"span","marks":[],"text":"Here are some more examples:","_key":"b85c8dc9aec80"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"69d6768a4d8b","children":[{"_type":"span","marks":[],"text":"This website is being stored in your computer's RAM right now","_key":"69d6768a4d8b0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"97a601c2f95f","children":[{"_type":"span","marks":[],"text":"If you're playing music, it is buffering through your system's memory","_key":"97a601c2f95f0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"d48cd3c40d8d","children":[{"_type":"span","marks":[],"text":"Any currently running programs have access to RAM to store whatever they need","_key":"d48cd3c40d8d0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"e9e428f1ddfc","children":[{"_type":"span","marks":[],"text":"RAM is a lot easier to understand than CPU. To put it simply, the more programs you run, the more RAM your system will need. However, some programs (","_key":"e9e428f1ddfc0"},{"_type":"span","marks":["em"],"text":"cough","_key":"e9e428f1ddfc1"},{"_type":"span","marks":[],"text":" ","_key":"e9e428f1ddfc2"},{"_type":"span","marks":["62b54a84202c"],"text":"Google Chrome","_key":"e9e428f1ddfc3"},{"_type":"span","marks":[],"text":" ","_key":"e9e428f1ddfc4"},{"_type":"span","marks":["em"],"text":"cough","_key":"e9e428f1ddfc5"},{"_type":"span","marks":[],"text":") use more memory than others. Unfortunately as a user, you have limited control over how much memory your applications use.","_key":"e9e428f1ddfc6"}],"markDefs":[{"_key":"62b54a84202c","_type":"link","href":"https://c.tenor.com/ma0A_HhmKhEAAAAM/chrome-ram.gif"}],"_type":"block","style":"normal"},{"_key":"e029c3634637","children":[{"_type":"span","marks":[],"text":"How much memory do I get on Replit?","_key":"e029c36346370"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"a0c8e8086806","children":[{"_type":"span","marks":[],"text":"All free repls are allocated 1 GiB of memory. Hacker repls have 2 GB by default, and 4 GB when boosted.","_key":"a0c8e80868060"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9e43a99d76ca","children":[{"_type":"span","marks":[],"text":"If you try to use more memory than you have available, the application using too much memory will be terminated. You can test this by running the following program in a C repl:","_key":"9e43a99d76ca0"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"#include <stdio.h>\n#include <stdlib.h>\n\nint main(void) {\n  for (int i = 0; i < 1000000; i++) {\n    malloc(1024 * 1024);\n  }\n  return 0;\n}\n","_key":"fc0d8e9a85dd"},{"_key":"ae4928c254c4","children":[{"_type":"span","marks":[],"text":"This is a simple loop that tries to allocate a large amount of memory. If you run this, you'll see output such as the following:","_key":"ae4928c254c40"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"$ ./main\nsignal: killed\n","_key":"a1cda7f74444"},{"_key":"8df75863b862","children":[{"_type":"span","marks":[],"text":"The new resource monitoring component will help you see how much memory your repl is using. The free tier of 1 GB is enough for most basic programs, but power users may want to consider ","_key":"8df75863b8620"},{"_type":"span","marks":["720a83fc29f4"],"text":"purchasing Cycles","_key":"8df75863b8621"},{"_type":"span","marks":[],"text":" for Boosts or ","_key":"8df75863b8622"},{"_type":"span","marks":["cfc2b8e21832"],"text":"upgrading to Hacker","_key":"8df75863b8623"},{"_type":"span","marks":[],"text":" to run into these resource limits less frequently.","_key":"8df75863b8624"}],"markDefs":[{"_key":"720a83fc29f4","_type":"link","href":"https://replit.com/cycles"},{"_key":"cfc2b8e21832","_type":"link","href":"https://replit.com/pricing"}],"_type":"block","style":"normal"},{"_key":"adc8815c00e5","children":[{"_type":"span","marks":[],"text":"Storage","_key":"adc8815c00e50"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"ab3f95675daa","children":[{"_type":"span","marks":[],"text":"Storage is the easiest resource to understand. Each repl gets a 1 GB filesystem on an SSD, or Solid State Drive. SSDs are becoming the default in nearly all laptops and personal computers because they are so much faster than traditional hard drives, or HDDs.","_key":"ab3f95675daa0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"df2b68c00509","children":[{"_type":"span","marks":[],"text":"You can view how much total storage you're using in the new resource monitoring component. You can also type the command ","_key":"df2b68c005090"},{"_type":"span","marks":["code"],"text":"du -sh ~/$REPL_SLUG","_key":"df2b68c005091"},{"_type":"span","marks":[],"text":" in the shell of any repl and see how much space your files are taking up.","_key":"df2b68c005092"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9f4c4e1b0e3d","children":[{"_type":"span","marks":[],"text":"To see how much space an individual file may be using, you can use the ","_key":"9f4c4e1b0e3d0"},{"_type":"span","marks":["code"],"text":"ls","_key":"9f4c4e1b0e3d1"},{"_type":"span","marks":[],"text":" command. Navigate to any folder with ","_key":"9f4c4e1b0e3d2"},{"_type":"span","marks":["code"],"text":"cd","_key":"9f4c4e1b0e3d3"},{"_type":"span","marks":[],"text":", and type ","_key":"9f4c4e1b0e3d4"},{"_type":"span","marks":["code"],"text":"ls -lh","_key":"9f4c4e1b0e3d5"},{"_type":"span","marks":[],"text":" in the shell:","_key":"9f4c4e1b0e3d6"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"$ ls -lh\ntotal 152K\n-rw-r--r-- 1 runner runner 132K Apr 12  2021 db.sqlite3\n-rw-r--r-- 1 runner runner  647 Jan 27  2020 manage.py\ndrwxr-xr-x 1 runner runner  108 Apr 12  2021 mysite\n-rw-r--r-- 1 runner runner 2.1K Jan 14  2021 poetry.lock\ndrwxr-xr-x 1 runner runner   46 Jan 27  2020 __pycache__\n-rw-r--r-- 1 runner runner  294 Jan 14  2021 pyproject.toml\n-rw-r--r-- 1 runner runner 1.3K Apr 12  2021 README.md\n-rw-r--r-- 1 runner runner    7 Jan 27  2020 requirements.txt\ndrwxr-xr-x 1 runner runner   20 Apr 12  2021 templates\ndrwxr-xr-x 1 runner runner  158 Apr 12  2021 todo\n","_key":"31eb64f8e59f"},{"_key":"ead0458d78e9","children":[{"_type":"span","marks":[],"text":"You can see that db.sqlite3 is taking up 132 KB of space, manage.py is using 647 bytes, the folder as a whole is using 152 KB, and so on.","_key":"ead0458d78e90"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"1857f916a972","children":[{"_type":"span","marks":[],"text":"Due to some limitations in our platform, we are unable to provide more than 1 GB of storage in any repl. We are actively working on improvements that will allow us to give users arbitrarily large filesystems to work with.","_key":"1857f916a9720"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"df8f0cf73f33","children":[{"_type":"span","marks":[],"text":"If you're running out of storage space in your repl, you can delete some files or use an external storage provider such as ","_key":"df8f0cf73f330"},{"_type":"span","marks":["7fe431f659ac"],"text":"GCS","_key":"df8f0cf73f331"},{"_type":"span","marks":[],"text":".","_key":"df8f0cf73f332"}],"markDefs":[{"_key":"7fe431f659ac","_type":"link","href":"https://cloud.google.com/storage"}],"_type":"block","style":"normal"},{"_key":"76f6350f2a79","children":[{"_type":"span","marks":[],"text":"Conclusion","_key":"76f6350f2a790"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"7e552db6b944","children":[{"_type":"span","marks":[],"text":"If you made it the end of this post, congratulations! You are well on your way to understanding how the system works under the hood.","_key":"7e552db6b9440"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"df86bd6f0f66","children":[{"_type":"span","marks":[],"text":"We're always trying to find ways to give people as many resources as possible, for as inexpensively as possible. In one sense, allocating resources to users in an efficient and accessible way is the core problem we are solving as a company.","_key":"df86bd6f0f660"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"e08b51890e11","children":[{"_type":"span","marks":[],"text":"The new resource utilization component gives users a better window into how their repl is operating under the hood. There's so much more work like this to do -- if this post interested you, ","_key":"e08b51890e110"},{"_type":"span","marks":["eb269a538968"],"text":"consider joining us","_key":"e08b51890e111"},{"_type":"span","marks":[],"text":"!","_key":"e08b51890e112"}],"markDefs":[{"_key":"eb269a538968","_type":"link","href":"https://replit.com/site/careers"}],"_type":"block","style":"normal"}],"publishedAt":"2022-01-31T20:00:00.000Z"}