{"_id":"post-bb7c2bc3-feba-48f1-b0d1-cd3515e64cbd","_type":"post","title":"How we went from supporting 50 languages to all of them","slug":{"_type":"slug","current":"nix"},"body":[{"_key":"1ca017c43636","children":[{"_type":"span","marks":[],"text":"At Replit, we want to give our users the most powerful, flexible, and easy-to-get-started coding environment. However, it has been limiting because we only support a fixed set of languages and OS packages, some of which are outdated. Ideally, users should be able to use any language and install any package with minimal fuss. That's why today, we're announcing that we've incorporated ","_key":"1ca017c436360"},{"_type":"span","marks":["95b97d17da0d"],"text":"Nix","_key":"1ca017c436361"},{"_type":"span","marks":[],"text":" in our infrastructure to give users access to over 30,000 OS packages instantly.","_key":"1ca017c436362"}],"markDefs":[{"_key":"95b97d17da0d","_type":"link","href":"https://nixos.org"}],"_type":"block","style":"normal"},{"_key":"7c5038996e67","children":[{"_type":"span","marks":[],"text":"The environment repls run in has long been a static world. We build a pre-baked OS image to fit all our languages. This gives us a lot of leeway to make repls super fast, but the underlying operating system repls run in is completely immutable. To remedy the situation we've been maintaining an ever growing ","_key":"7c5038996e670"},{"_type":"span","marks":["31bfab6a064b"],"text":"OS image","_key":"7c5038996e671"},{"_type":"span","marks":[],"text":", if users can't install any packages we'll just install every package! As awesome as this sounds it has become a huge burden to maintain. Every new package creates a new exciting way things can break.","_key":"7c5038996e672"}],"markDefs":[{"_key":"31bfab6a064b","_type":"link","href":"https://github.com/replit/polygott"}],"_type":"block","style":"normal"},{"_key":"1846906dadf5","children":[{"_type":"span","marks":[],"text":"Over time, it became clear that maintaining a single, massive docker image was not sustainable. We came across ","_key":"1846906dadf50"},{"_type":"span","marks":["9ea2f5766e6e"],"text":"Nix","_key":"1846906dadf51"},{"_type":"span","marks":[],"text":" which is a declarative, reproducable OS package manager. Due to Nix's design its package store is highly cacheable and allows for building environments in a composable way. Using the Nix programming language you can specify the dependencies for your development environment and Nix will build the environment for you. We believe this is a great fit for Replit as it allows our users to build endless combinations of development environments without us having to maintain a monolithic docker image.","_key":"1846906dadf52"}],"markDefs":[{"_key":"9ea2f5766e6e","_type":"link","href":"https://nixos.org"}],"_type":"block","style":"normal"},{"_key":"52b5c826bb9e","children":[{"_type":"span","marks":[],"text":"With Nix on Replit, see how easily you can create a ","_key":"52b5c826bb9e0"},{"_type":"span","marks":["de5f01b60092"],"text":"Zig","_key":"52b5c826bb9e1"},{"_type":"span","marks":[],"text":" environment in a few seconds. We create a ","_key":"52b5c826bb9e2"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"52b5c826bb9e3"},{"_type":"span","marks":[],"text":" file to tell the repl which Nix packages should be available when we run. Then we use ","_key":"52b5c826bb9e4"},{"_type":"span","marks":["fba586868467"],"text":".replit","_key":"52b5c826bb9e5"},{"_type":"span","marks":[],"text":" to control what the run button does. And voila we have a new language:","_key":"52b5c826bb9e6"}],"markDefs":[{"_key":"de5f01b60092","_type":"link","href":"https://ziglang.org/"},{"_key":"fba586868467","_type":"link","href":"https://docs.replit.com/repls/dot-replit"}],"_type":"block","style":"normal"},{"_key":"e954afe7d6bf","children":[{"_type":"span","marks":[],"text":"How it works","_key":"e954afe7d6bf0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"bcccf3381903","children":[{"_type":"span","marks":[],"text":"Utilizing the power of Nix, every repl comes preloaded with over 30,000 packages. Adding a package is as simple as adding it as a dependency in the ","_key":"bcccf33819030"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"bcccf33819031"},{"_type":"span","marks":[],"text":" file. The best part is these packages are already available in every repl and don't need to be downloaded. To accomplish this we've prebuilt a Nix store with every package already downloaded. This is a huge 1 terabyte shared disk image we mount into every repl right under ","_key":"bcccf33819032"},{"_type":"span","marks":["code"],"text":"/nix","_key":"bcccf33819033"},{"_type":"span","marks":[],"text":", building on our ","_key":"bcccf33819034"},{"_type":"span","marks":["43040db526b2"],"text":"existing package caching technology","_key":"bcccf33819035"},{"_type":"span","marks":[],"text":". This means we can build a single disk image with all Nix packages once and share it among every single repl. The novel layout of Nix's content addressable store make this conflict free even with many versions of the same package. When activating, your environment will only be populated with the exact packages you depend on from the store.","_key":"bcccf33819036"}],"markDefs":[{"_key":"43040db526b2","_type":"link","href":"https://blog.replit.com/python-package-cache"}],"_type":"block","style":"normal"},{"_key":"244a40fff305","children":[{"_type":"span","marks":[],"text":"Examples","_key":"244a40fff3050"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"f44682ffcd18","children":[{"_type":"span","marks":[],"text":"Check out some of our example Nix repls for various languages:","_key":"f44682ffcd180"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"13279758ac87","children":[{"_type":"span","marks":["7d9980e0e8d3"],"text":"Zig","_key":"13279758ac870"}],"markDefs":[{"_key":"7d9980e0e8d3","_type":"link","href":"https://replit.com/@ConnorBrewster/zig"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"d50f624a7bca","children":[{"_type":"span","marks":["93b06a8a41fd"],"text":"Node.js 16","_key":"d50f624a7bca0"}],"markDefs":[{"_key":"93b06a8a41fd","_type":"link","href":"https://replit.com/@ConnorBrewster/nodejs16"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"744670abd35b","children":[{"_type":"span","marks":["fe61ea7159d7"],"text":"Clojure","_key":"744670abd35b0"}],"markDefs":[{"_key":"fe61ea7159d7","_type":"link","href":"https://replit.com/@turbio/nixed-clojure"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"b5e091838aa7","children":[{"_type":"span","marks":["0048721b4bd6"],"text":"C# Dotnet","_key":"b5e091838aa70"}],"markDefs":[{"_key":"0048721b4bd6","_type":"link","href":"https://replit.com/@turbio/dotnet"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"6baa9f9e42f6","children":[{"_type":"span","marks":[],"text":"Check out our ","_key":"6baa9f9e42f60"},{"_type":"span","marks":["903b6f41a3c0"],"text":"Nix docs","_key":"6baa9f9e42f61"},{"_type":"span","marks":[],"text":" to build your own","_key":"6baa9f9e42f62"}],"markDefs":[{"_key":"903b6f41a3c0","_type":"link","href":"https://docs.replit.com/repls/nix"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"60259eaeba92","children":[{"_type":"span","marks":[],"text":"What's Next","_key":"60259eaeba920"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"3de676a74d73","children":[{"_type":"span","marks":[],"text":"The next stage in Replit and Nix integration is allowing more flexible configuration of the repl itself. Today, you can already modify the run command of repls through the ","_key":"3de676a74d730"},{"_type":"span","marks":["2480920e4e9e","code"],"text":".replit","_key":"3de676a74d731"},{"_type":"span","marks":["2480920e4e9e"],"text":" file","_key":"3de676a74d732"},{"_type":"span","marks":[],"text":". We plan to extend the functionality of ","_key":"3de676a74d733"},{"_type":"span","marks":["code"],"text":".replit","_key":"3de676a74d734"},{"_type":"span","marks":[],"text":" to allow for configuration of things like ","_key":"3de676a74d735"},{"_type":"span","marks":["cf2205ebea53"],"text":"LSP","_key":"3de676a74d736"},{"_type":"span","marks":[],"text":" to customize code intelligence for your environment.","_key":"3de676a74d737"}],"markDefs":[{"_key":"2480920e4e9e","_type":"link","href":"https://docs.replit.com/repls/dot-replit"},{"_key":"cf2205ebea53","_type":"link","href":"https://en.wikipedia.org/wiki/Language_Server_Protocol"}],"_type":"block","style":"normal"},{"_key":"afa4d1737abb","children":[{"_type":"span","marks":[],"text":"We are also working on caching nix-shell environments for faster run experience, right now Nix has to rebuild the repl environment every time you hit the run button which can add a couple seconds of delay. (Edit: Nix environments are now cached)","_key":"afa4d1737abb0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"2bd2aff1f5e3","children":[{"_type":"span","marks":[],"text":"While Nix on Replit is in its early stages, we are looking for people to try it out and build custom environments. If you have any questions or feedback, don't hesitate to reach out to us at ","_key":"2bd2aff1f5e30"},{"_type":"span","marks":["881fcef48a04"],"text":"mason@replit.com","_key":"2bd2aff1f5e31"},{"_type":"span","marks":[],"text":" or ","_key":"2bd2aff1f5e32"},{"_type":"span","marks":["2b465af3a862"],"text":"connor@replit.com","_key":"2bd2aff1f5e33"},{"_type":"span","marks":[],"text":".","_key":"2bd2aff1f5e34"}],"markDefs":[{"_key":"881fcef48a04","_type":"link","href":"mailto:mason@replit.com"},{"_key":"2b465af3a862","_type":"link","href":"mailto:connor@replit.com"}],"_type":"block","style":"normal"},{"_key":"a6887d2656e1","children":[{"_type":"span","marks":[],"text":"P.S. You can install and run i3 via Nix in a ","_key":"a6887d2656e10"},{"_type":"span","marks":["02e66ab84389"],"text":"repl","_key":"a6887d2656e11"}],"markDefs":[{"_key":"02e66ab84389","_type":"link","href":"https://replit.com/@ConnorBrewster/i3"}],"_type":"block","style":"normal"}],"publishedAt":"2021-05-24T18:30:56.792Z"}