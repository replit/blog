{"_id":"post-1110c56b-bce4-4314-ad04-793f5e221740","_type":"post","title":"April 2 Potential GitHub Credentials Exposure","slug":{"_type":"slug","current":"april-02-potential-github-credentials-exposure"},"body":[{"_key":"71d274e1698a","children":[{"_type":"span","marks":[],"text":"Yesterday, on April 2, 2023, Replit discovered a site vulnerability that may have exposed GitHub ","_key":"71d274e1698a0"},{"_type":"span","marks":["a76097c9a006"],"text":"auth tokens","_key":"71d274e1698a1"},{"_type":"span","marks":[],"text":" for <0.01% of Replit users, stemming from use of the ","_key":"71d274e1698a2"},{"_type":"span","marks":["8ed547e03b42"],"text":"GitHub import feature","_key":"71d274e1698a3"},{"_type":"span","marks":[],"text":". This could have permitted unauthorized read/write access to all the repositories of those users by default (users can choose to authorize just a subset of repositories).","_key":"71d274e1698a4"}],"markDefs":[{"_key":"a76097c9a006","_type":"link","href":"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/about-authentication-to-github#githubs-token-formats"},{"_key":"8ed547e03b42","_type":"link","href":"https://docs.replit.com/programming-ide/using-git-on-replit/import-repository"}],"_type":"block","style":"normal"},{"_key":"d775e92d5638","children":[{"_type":"span","marks":[],"text":"We have no indication that those exposed tokens were misused or used to exploit GitHub repositories.","_key":"d775e92d56380"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"854ae0b071e3","children":[{"_type":"span","marks":[],"text":"The vulnerability has been fixed, all existing GitHub auth tokens associated with the Replit app have been revoked, and access to the GitHub import feature has been restored.","_key":"854ae0b071e30"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"721527a7a647","children":[{"_type":"span","marks":[],"text":"The number of exposed users was limited to <0.01% because there are two preconditions that needed to be met for a user’s Repl to be vulnerable:","_key":"721527a7a6470"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"7c11a9b35ada","children":[{"_type":"span","marks":[],"text":"The Repl was created using the GitHub import feature; and","_key":"7c11a9b35ada0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"816788c13de7","children":[{"_type":"span","marks":[],"text":"One of: ","_key":"816788c13de70"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"6523807c90f6","children":[{"_type":"span","marks":[],"text":"The Repl was public and it was forked by another user","_key":"6523807c90f60"}],"markDefs":[],"_type":"block","style":"normal","level":2,"listItem":"bullet"},{"_key":"2ff31ec90c09","children":[{"_type":"span","marks":[],"text":"The Repl was a statically-hosted HTML Repl and the user had interacted with the files in the git reflog through the editor","_key":"2ff31ec90c090"}],"markDefs":[],"_type":"block","style":"normal","level":2,"listItem":"bullet"},{"_key":"282febfdacc0","children":[{"_type":"span","marks":[],"text":"The Repl had an HTTP server configured to serve all the files in the current directory","_key":"282febfdacc00"}],"markDefs":[],"_type":"block","style":"normal","level":2,"listItem":"bullet"},{"_key":"6792766d7160","children":[{"_type":"span","marks":[],"text":"We have notified all users meeting these two preconditions whose tokens may have been exposed. All users will need to re-approve the use of GitHub in Replit since their previous approvals have been revoked out of caution.","_key":"6792766d71600"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"7d8e7fffefd2","children":[{"_type":"span","marks":[],"text":"Technical details","_key":"7d8e7fffefd20"}],"markDefs":[],"_type":"block","style":"h1"},{"_key":"c327a81536b8","children":[{"_type":"span","marks":[],"text":"In 2019, we introduced a feature that allowed users to import a GitHub repository as a Repl. In order to communicate with GitHub on a user's behalf, Replit used ","_key":"c327a81536b80"},{"_type":"span","marks":["286040abdee4"],"text":"user-to-server tokens","_key":"c327a81536b81"},{"_type":"span","marks":[],"text":". For repositories selected by the user, these tokens grant Replit access to:","_key":"c327a81536b82"}],"markDefs":[{"_key":"286040abdee4","_type":"link","href":"https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/authenticating-with-a-github-app-on-behalf-of-a-user"}],"_type":"block","style":"normal"},{"_key":"9c122939881a","children":[{"_type":"span","marks":[],"text":"Administration: read and write access for repository creation, deletion, settings, teams, and collaborators.","_key":"9c122939881a0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"6ef2eb8428b8","children":[{"_type":"span","marks":[],"text":"Contents: read and write access for repository contents, commits, branches, downloads, releases, and merges.","_key":"6ef2eb8428b80"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"b7ee9ae60141","children":[{"_type":"span","marks":[],"text":"Metadata: read only access to search repositories, list collaborators, and access repository metadata.","_key":"b7ee9ae601410"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"866527f54af7","children":[{"_type":"span","marks":[],"text":"Email addresses: read only access to the user’s email addresses.","_key":"866527f54af70"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"da2a543c8755","children":[{"_type":"span","marks":[],"text":"This feature cloned the repository with a URL that contained the user-to-server token, which was written to a file in GitHub-imported Repls in the git ","_key":"da2a543c87550"},{"_type":"span","marks":["52780473d64f"],"text":"reflog","_key":"da2a543c87551"},{"_type":"span","marks":[],"text":".","_key":"da2a543c87552"}],"markDefs":[{"_key":"52780473d64f","_type":"link","href":"https://git-scm.com/docs/gitrepository-layout#Documentation/gitrepository-layout.txt-logsrefsheadscodenamecode"}],"_type":"block","style":"normal"},{"_key":"89f55f2dd3e4","children":[{"_type":"span","marks":[],"text":"As a result of this vulnerability,","_key":"89f55f2dd3e40"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4b8a572563fd","children":[{"_type":"span","marks":[],"text":"If the Repl's visibility was set to public, the reflog could have been left vulnerable to local inspection after forking the Repl.","_key":"4b8a572563fd0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"5a3866cc2241","children":[{"_type":"span","marks":[],"text":"If the Repl had an HTTP server, either because the Repl was a statically-hosted HTML Repl or because it was configured to serve all the files in the current directory, the reflog was left vulnerable to remote inspection over the internet.","_key":"5a3866cc22410"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"413ed9530f34","children":[{"_type":"span","marks":[],"text":"What action do affected users need to take?","_key":"413ed9530f340"}],"markDefs":[],"_type":"block","style":"h1"},{"_key":"c25f15b1872c","children":[{"_type":"span","marks":[],"text":"There is no action needed to secure Replit connections to GitHub. We revoked all prior users' authorizations (regardless of whether they were exposed or not), so all users will be re-authenticated automatically when using GitHub related features.","_key":"c25f15b1872c0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d7eaf75c9fea","children":[{"_type":"span","marks":[],"text":"However, notified users should conduct an audit of their GitHub logs to check public and private repositories for evidence of suspicious activity. To request logs from GitHub:","_key":"d7eaf75c9fea0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d249685bc206","children":[{"_type":"span","marks":[],"text":"For organizations: please see the instructions in the GitHub document, ","_key":"d249685bc2060"},{"_type":"span","marks":["910ca7cde391"],"text":"Review the audit log for your organization","_key":"d249685bc2061"},{"_type":"span","marks":[],"text":".","_key":"d249685bc2062"}],"markDefs":[{"_key":"910ca7cde391","_type":"link","href":"https://docs.github.com/en/organizations/keeping-your-organization-secure/managing-security-settings-for-your-organization/reviewing-the-audit-log-for-your-organization"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"9275c8cec608","children":[{"_type":"span","marks":[],"text":"For personal accounts: please see the instructions in the GitHub document, ","_key":"9275c8cec6080"},{"_type":"span","marks":["6204a89a30de"],"text":"Reviewing your security log","_key":"9275c8cec6081"},{"_type":"span","marks":[],"text":".","_key":"9275c8cec6082"}],"markDefs":[{"_key":"6204a89a30de","_type":"link","href":"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/reviewing-your-security-log"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"f6081468e4e5","children":[{"_type":"span","marks":[],"text":"Private GitHub repositories often contain secret information such as credentials. If notified users find any suspicious activity, they should revoke or rotate visible secrets in any repository that they granted Replit access to.","_key":"f6081468e4e50"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"e49ac462ddd1","children":[{"_type":"span","marks":[],"text":"If a user finds evidence of suspicious activity in their connected GitHub repositories or other impact, they should open a case with ","_key":"e49ac462ddd10"},{"_type":"span","marks":["30bcbe2165b1"],"text":"Replit Support (support@replit.com)","_key":"e49ac462ddd11"},{"_type":"span","marks":[],"text":".","_key":"e49ac462ddd12"}],"markDefs":[{"_key":"30bcbe2165b1","_type":"link","href":"mailto:support@replit.com"}],"_type":"block","style":"normal"},{"_key":"c1d410f1bc96","children":[{"_type":"span","marks":[],"text":"What actions has Replit taken so far?","_key":"c1d410f1bc960"}],"markDefs":[],"_type":"block","style":"h1"},{"_key":"82d3e172e93b","children":[{"_type":"span","marks":[],"text":"We started investigating immediately after receiving the notice about a potential vulnerability. Within hours, our security team took prompt action to analyze and mitigate the issue. We took the following actions to remedy (all times US Pacific Time):","_key":"82d3e172e93b0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"73ccc5613925","children":[{"_type":"span","marks":["strong"],"text":"Sunday, April 2, 2023","_key":"73ccc56139250"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"767cc5a9b277","children":[{"_type":"span","marks":[],"text":"11:21: An internal incident was created and scope and mitigation steps determined.","_key":"767cc5a9b2770"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"6cc78862eee0","children":[{"_type":"span","marks":[],"text":"11:48: Disabled the GitHub import feature to prevent more users from being affected by this. ","_key":"6cc78862eee00"},{"_type":"span","marks":["em","strong"],"text":"No new users are affected after this point","_key":"6cc78862eee01"},{"_type":"span","marks":[],"text":".","_key":"6cc78862eee02"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"a0f6a2b33ebf","children":[{"_type":"span","marks":[],"text":"11:52: Began enumerating all users that had their auth tokens exposed.","_key":"a0f6a2b33ebf0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"0b8eaa3f5f27","children":[{"_type":"span","marks":[],"text":"12:37: Began revoking all auth tokens for all users, regardless of exposure.","_key":"0b8eaa3f5f270"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"cd8cebc42f4c","children":[{"_type":"span","marks":[],"text":"12:50: Discovered root cause and relevant code removed.","_key":"cd8cebc42f4c0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"bd12e5653435","children":[{"_type":"span","marks":[],"text":"13:29: Examined HTTP logs to determine which users had attempts to access their auth tokens for possible exposure.","_key":"bd12e56534350"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"1af82907f78f","children":[{"_type":"span","marks":[],"text":"15:03: Addressed the original vulnerability by no longer passing the auth token into the URL when importing GitHub repositories.","_key":"1af82907f78f0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"eae440067725","children":[{"_type":"span","marks":[],"text":"17:30: Started rejecting any attempts to perform any commands that would result in an auth token being written to the git reflog. No more auth tokens have been exposed since this point.","_key":"eae4400677250"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"a50493631e44","children":[{"_type":"span","marks":[],"text":"18:07: Audited all codepaths that were related to GitHub authentication and authorization.","_key":"a50493631e440"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"4a8894401d25","children":[{"_type":"span","marks":[],"text":"18:19: Deleted the GitHub app to immediately revoke all preexisting auth tokens. ","_key":"4a8894401d250"},{"_type":"span","marks":["em","strong"],"text":"Any previously-exposed auth tokens stopped working at this point.","_key":"4a8894401d251"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"7c34cdbb1c76","children":[{"_type":"span","marks":["strong"],"text":"Monday, April 3, 2024","_key":"7c34cdbb1c760"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"8ab445938a0a","children":[{"_type":"span","marks":[],"text":"08:43: After all mitigation steps were in place, a new GitHub app was created to restore the functionality that was disabled securely.","_key":"8ab445938a0a0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"ab30abad478f","children":[{"_type":"span","marks":[],"text":"13:43: Examined all Repls to identify whether there were auth tokens in their reflogs to see which users were in a potentially vulnerable state.","_key":"ab30abad478f0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"55c05aa4a900","children":[{"_type":"span","marks":[],"text":"18:00: Notified impacted users directly by email.","_key":"55c05aa4a9000"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"08edc2fe6827","children":[{"_type":"span","marks":[],"text":"What are the next steps for Replit?","_key":"08edc2fe68270"}],"markDefs":[],"_type":"block","style":"h1"},{"_key":"375aaa8faa19","children":[{"_type":"span","marks":[],"text":"Replit takes security very seriously, especially when it relates to users' data. We are taking complete responsibility of this incident. Every time there is a security incident, we want to learn from it and make changes so that it (or similar incidents) don't happen again.","_key":"375aaa8faa190"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"f414737a1fc3","children":[{"_type":"span","marks":[],"text":"In addition to fixing this particular vulnerability, we will increase the use of static code analysis tools to ensure information is not sent without appropriate corresponding permissions. We are also preparing to scan Repls for instances of potentially misplaced credentials. This goes beyond the scope of this incident, is generally a good practice, and can help protect other secrets like Discord tokens.","_key":"f414737a1fc30"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c16f8ee25469","children":[{"_type":"span","marks":[],"text":"Responsible disclosure","_key":"c16f8ee254690"}],"markDefs":[],"_type":"block","style":"h1"},{"_key":"1f5877ed93db","children":[{"_type":"span","marks":[],"text":"Thanks to ","_key":"1f5877ed93db0"},{"_type":"span","marks":["9086fe811f44"],"text":"@LuisAFK","_key":"1f5877ed93db1"},{"_type":"span","marks":[],"text":", a 14-year-old hacker from the Replit community, for finding and reporting this vulnerability and following a ","_key":"1f5877ed93db2"},{"_type":"span","marks":["be911916e448"],"text":"responsible disclosure","_key":"1f5877ed93db3"},{"_type":"span","marks":[],"text":" process with us. If you want to report a vulnerability to us, please reach out to ","_key":"1f5877ed93db4"},{"_type":"span","marks":["d79cef3f5946"],"text":"security@replit.com","_key":"1f5877ed93db5"},{"_type":"span","marks":[],"text":" and we can coordinate.","_key":"1f5877ed93db6"}],"markDefs":[{"_key":"9086fe811f44","_type":"link","href":"https://replit.com/@LuisAFK"},{"_key":"be911916e448","_type":"link","href":"https://en.wikipedia.org/wiki/Coordinated_vulnerability_disclosure"},{"_key":"d79cef3f5946","_type":"link","href":"mailto:security@replit.com"}],"_type":"block","style":"normal"}],"publishedAt":"2023-04-04T02:00:00.000Z"}