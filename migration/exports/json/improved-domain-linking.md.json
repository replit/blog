{"_id":"post-06a40ca0-50da-42cd-b508-5ee8c949404d","_type":"post","title":"Improving Domain Linking for Repls","slug":{"_type":"slug","current":"improved-domain-linking"},"body":[{"_key":"5831b42134b5","children":[{"_type":"span","marks":[],"text":"For some time now, it's been possible to link your custom domain to your Repl. You buy that perfect domain name, connect it to your website hosted on Replit, and you're good to go! Custom domains help you create a unique home on the internet - for your blog, a product you're launching, or just a space to try new ideas.","_key":"5831b42134b50"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"5e542e3eb1f0","children":[{"_type":"span","marks":[],"text":"We are rolling out domain linking improvements - direct apex domain linking, magic domain linking, and multiple domain support. We also updated our domain verification logic! You can experience these right now if you're an explorer. Otherwise, these will make it to you soon!","_key":"5e542e3eb1f00"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d54e50d11c0d","children":[{"_type":"span","marks":[],"text":"Domain Verification Logic","_key":"d54e50d11c0d0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"8ea8979efcbc","children":[{"_type":"span","marks":[],"text":"Previously, we would verify your domain by attempting to access a special Replit proxy-enabled route on the domain. As the number of domains grew, our servers' time spent verifying domains increased. We wanted to make this process more efficient. We updated the logic to verify DNS (the internet's address book) records - speedy! - before further checks. Verification happens on a slightly different cadence, in batches now.","_key":"8ea8979efcbc0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"7c1d2d96bc0a","children":[{"_type":"span","marks":[],"text":"In addition, every evening, we reverify domains. This daily re-verification process checks to see if we can still access your repl through your domain. If we encounter a problem, your domain linking status panel will update to show the domain is no longer \"verified.\" Where possible, we'll show you the records that we see to make troubleshooting easier.","_key":"7c1d2d96bc0a0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"bd3e93d85f25","children":[{"_type":"span","marks":[],"text":"Because we are now verifying DNS records, and services like Cloudflare's \"orange-cloud\" modify DNS, we added TXT record verification to save you from having to turn off Cloudflare (or other systems) protection to successfully link.","_key":"bd3e93d85f250"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c360839950d4","children":[{"_type":"span","_key":"c360839950d40","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4719ac89cce4","children":[{"_type":"span","marks":[],"text":"Apex Domain Linking","_key":"4719ac89cce40"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"6c98daf42f39","children":[{"_type":"span","marks":[],"text":"An \"apex domain\" is the top-level name in a domain. For example, replit.com is an apex domain, but blog.replit.com is not. These have special requirements in DNS. One requirement is that the CNAME record type we typically use to link must not be at the domain's apex. Service providers like Cloudflare offer features like \"CNAME Flattening\" that implement just-in-time resolution to let you work around this limitation. However, if your DNS service provider does not support this feature, you were out of luck.","_key":"6c98daf42f390"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"ef69c258b77f","children":[{"_type":"span","marks":[],"text":"We built a separate proxy for your apex domains to work around this. This apex domain proxy uses a TXT record to figure out your repl's location and then forwards web traffic to it. That means you can use an A record in your domain's DNS; everything just works!","_key":"ef69c258b77f0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"73b7b5650d40","children":[{"_type":"span","marks":[],"text":"Magic Domain Linking","_key":"73b7b5650d400"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"ddf3bef05317","children":[{"_type":"span","marks":[],"text":"As we began implementing more options for domain verification that use TXT records, we realized we could utilize this to enable ","_key":"ddf3bef053170"},{"_type":"span","marks":["1fa1078987d3"],"text":"\"magic\" domain linking","_key":"ddf3bef053171"},{"_type":"span","marks":[],"text":". Magic linking allows your domain to work similarly to the existing .repl.co domain - without the repl.co!","_key":"ddf3bef053172"}],"markDefs":[{"_key":"1fa1078987d3","_type":"link","href":"https://replit.com/@mattiselin/dns-magic-linking"}],"_type":"block","style":"normal"},{"_key":"3faef41a88b9","children":[{"_type":"span","marks":[],"text":"This apex domain proxy runs at 34.132.134.162 - that can be used for your A record (and you'll see it in the domain linking setup screen too).","_key":"3faef41a88b90"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"40240d0428dc","children":[{"_type":"span","marks":[],"text":"Let's look at an example - I recently bought mattsrepls.com. I want all my repls to be available at that domain.","_key":"40240d0428dc0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"0ed781374f03","children":[{"_type":"span","marks":[],"text":"Step 1: I create a TXT record ","_key":"0ed781374f030"},{"_type":"span","marks":["code"],"text":"replit-user=mattiselin","_key":"0ed781374f031"},{"_type":"span","marks":[],"text":" on this domain.","_key":"0ed781374f032"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"c8348b6ef014","children":[{"_type":"span","marks":[],"text":"Step 2: I create an A record pointing at ","_key":"c8348b6ef0140"},{"_type":"span","marks":["code"],"text":"34.132.134.162","_key":"c8348b6ef0141"},{"_type":"span","marks":[],"text":" (the apex domain proxy) on mattsrepls.com","_key":"c8348b6ef0142"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"446cc1a8714d","children":[{"_type":"span","marks":[],"text":"Step 3: I create a wildcard CNAME record (","_key":"446cc1a8714d0"},{"_type":"span","marks":["code"],"text":"*.mattsrepls.com","_key":"446cc1a8714d1"},{"_type":"span","marks":[],"text":") pointing at ","_key":"446cc1a8714d2"},{"_type":"span","marks":["code"],"text":"mattiselin.repl.co","_key":"446cc1a8714d3"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"4e8d572659ac","children":[{"_type":"span","_key":"4e8d572659ac0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"600be6690a03","children":[{"_type":"span","marks":[],"text":"I have a Flask demo at ","_key":"600be6690a030"},{"_type":"span","marks":["cca8d061fa7f"],"text":"https://replit.com/@mattiselin/flask-1#main.py","_key":"600be6690a031"},{"_type":"span","marks":[],"text":". Usually, this would be ","_key":"600be6690a032"},{"_type":"span","marks":["049c591db96c"],"text":"https://flask-1.mattiselin.repl.co","_key":"600be6690a033"},{"_type":"span","marks":[],"text":". Now that I've added these magic linking records, this is accessible at ","_key":"600be6690a034"},{"_type":"span","marks":["31ecdc074e8b"],"text":"https://flask-1.mattsrepls.com","_key":"600be6690a035"},{"_type":"span","marks":[],"text":" too!","_key":"600be6690a036"}],"markDefs":[{"_key":"cca8d061fa7f","_type":"link","href":"https://replit.com/@mattiselin/flask-1#main.py"},{"_key":"049c591db96c","_type":"link","href":"https://flask-1.mattiselin.repl.co"},{"_key":"31ecdc074e8b","_type":"link","href":"https://flask-1.mattsrepls.com"}],"_type":"block","style":"normal"},{"_key":"d8117b50b99f","children":[{"_type":"span","marks":[],"text":"Our infrastructure will notice that you don't have a verified custom domain for the request and immediately kick off a DNS request to look for your ","_key":"d8117b50b99f0"},{"_type":"span","marks":["code"],"text":"replit-user","_key":"d8117b50b99f1"},{"_type":"span","marks":[],"text":" TXT record. If we find it, we'll treat the request like it was on the repl.co domain. We cache the DNS lookup, so even though the DNS request is already low-latency, the users of your websites won't get hit with increased latency on every request.","_key":"d8117b50b99f2"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"63bd30c10e53","children":[{"_type":"span","marks":[],"text":"Multiple Domain Linking","_key":"63bd30c10e530"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"66662db78bb1","children":[{"_type":"span","marks":[],"text":"Finally, the new verification logic enables support for multiple domains to point to a single repl. You might have a website that you want to appear at flask-1.mattsrepls.com and mattsrepls.com simultaneously - that's now possible! Each domain has an independent verification process and state.","_key":"66662db78bb10"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"8ab28e1fd105","children":[{"_type":"span","_key":"8ab28e1fd1050","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"88096f64f596","children":[{"_type":"span","marks":[],"text":"Happy domain linking!","_key":"88096f64f5960"}],"markDefs":[],"_type":"block","style":"normal"}],"publishedAt":"2022-07-04T16:00:00.000Z"}