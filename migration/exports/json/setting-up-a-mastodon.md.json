{"_id":"post-fff7e0d7-4d2b-456b-ae84-143ccc2c397b","_type":"post","title":"How to Set Up Your Own Mastodon Instance with Replit","slug":{"_type":"slug","current":"setting-up-a-mastodon"},"body":[{"_key":"a734178b8404","children":[{"_type":"span","marks":[],"text":"With many development tools and even whole development environments moving to the cloud, ","_key":"a734178b84040"},{"_type":"span","marks":["72f349abc92b"],"text":"Replit","_key":"a734178b84041"},{"_type":"span","marks":[],"text":" is at the forefront of this change.","_key":"a734178b84042"}],"markDefs":[{"_key":"72f349abc92b","_type":"link","href":"https://replit.com/"}],"_type":"block","style":"normal"},{"_key":"c31ca05c1d99","children":[{"_type":"span","marks":[],"text":"Replit is one of the leading cloud, in-browser IDEs with support for fifty-plus programming languages with syntax highlighting and intelligent autocompletion.","_key":"c31ca05c1d990"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d10aa9cdfa26","children":[{"_type":"span","marks":[],"text":"However, Replit is more than just an IDE in a cloud. With additional features like real-time collaboration, GitHub integration, and detailed edit history, Replit is a full-blown workspace for teams, educators, and interviewers.","_key":"d10aa9cdfa260"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"19bea0f04a21","children":[{"_type":"span","marks":[],"text":"This guide will show you how to install ","_key":"19bea0f04a210"},{"_type":"span","marks":["48d68a4a60c8"],"text":"Mastodon","_key":"19bea0f04a211"},{"_type":"span","marks":[],"text":" in the Replit environment, showing its versatility and potential.You can follow along with ","_key":"19bea0f04a212"},{"_type":"span","marks":["ea1a487926c5"],"text":"this Repl","_key":"19bea0f04a213"},{"_type":"span","marks":[],"text":".","_key":"19bea0f04a214"}],"markDefs":[{"_key":"48d68a4a60c8","_type":"link","href":"https://mastodon.social/about"},{"_key":"ea1a487926c5","_type":"link","href":"https://replit.com/@areknawo/Mastodon"}],"_type":"block","style":"normal"},{"_key":"f5de0f2a5f30","children":[{"_type":"span","marks":[],"text":"What Is Mastodon?","_key":"f5de0f2a5f300"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"c620c1c2d5b8","children":[{"_type":"span","marks":[],"text":"Before we start, let me introduce you to Mastodon: an open-source social networking software.","_key":"c620c1c2d5b80"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9f4232f7f3b7","children":[{"_type":"span","_key":"9f4232f7f3b70","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"fc97e7519d18","children":[{"_type":"span","marks":[],"text":"Mastodon’s goal is to move social networking back into the hands of people. It’s an alternative to the likes of Twitter, focused primarily on microblogging. With anti-abuse tools, a feature-packed admin dashboard, and tons of social-networking features, Mastodon is an excellent choice for individual or business use.","_key":"fc97e7519d180"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"97ccf9f7de90","children":[{"_type":"span","marks":[],"text":"On top of being open-source, Mastodon is built on open standards like ","_key":"97ccf9f7de900"},{"_type":"span","marks":["234074da0314"],"text":"ActivityPub","_key":"97ccf9f7de901"},{"_type":"span","marks":[],"text":", meaning there’s no lock-in. Thanks to such architecture, you can quickly transfer your data to other services supporting ActivityPub, if you ever choose to.","_key":"97ccf9f7de902"}],"markDefs":[{"_key":"234074da0314","_type":"link","href":"https://docs.joinmastodon.org/spec/activitypub/"}],"_type":"block","style":"normal"},{"_key":"0e5414f8af1c","children":[{"_type":"span","marks":[],"text":"Installing Mastodon in Replit","_key":"0e5414f8af1c0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"2d9673771647","children":[{"_type":"span","marks":[],"text":"Because Mastodon is a complex piece of software involving Redis, PostgreSQL, a Ruby backend, and a React frontend, installing it in a limited environment without root access, such as Replit, can be challenging. Thankfully, with recent updates, Replit ","_key":"2d96737716470"},{"_type":"span","marks":["c667664bb9f5"],"text":"now allows you to run Nix","_key":"2d96737716471"},{"_type":"span","marks":[],"text":"—a declarative, reproducible OS package manager—which makes running even the most complex apps on Replit possible.","_key":"2d96737716472"}],"markDefs":[{"_key":"c667664bb9f5","_type":"link","href":"https://blog.replit.com/nix"}],"_type":"block","style":"normal"},{"_key":"2e0e38634757","children":[{"_type":"span","marks":[],"text":"Creating Repl","_key":"2e0e386347570"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"81ab5b8ab13c","children":[{"_type":"span","marks":[],"text":"If you haven’t already, first ","_key":"81ab5b8ab13c0"},{"_type":"span","marks":["e57b7baafbc8"],"text":"create a Replit account","_key":"81ab5b8ab13c1"},{"_type":"span","marks":[],"text":". Then, start by creating a new Nix Repl.","_key":"81ab5b8ab13c2"}],"markDefs":[{"_key":"e57b7baafbc8","_type":"link","href":"https://replit.com/signup"}],"_type":"block","style":"normal"},{"_key":"5c60c0252146","children":[{"_type":"span","_key":"5c60c02521460","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"88f8d3e651a0","children":[{"_type":"span","marks":[],"text":"Two notes here:","_key":"88f8d3e651a00"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"6cb487093e77","children":[{"_type":"span","marks":[],"text":"Although relatively stable, Nix support is still in beta, meaning you might encounter some unexpected issues.","_key":"6cb487093e770"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"4b1accb96ba3","children":[{"_type":"span","marks":[],"text":"Mastodon installation is a resource-heavy process. It’s possible that during installation, a free Repl instance will run out of memory. Because of that, if you intend to play with Mastodon in Replit, it’s recommended that you ","_key":"4b1accb96ba30"},{"_type":"span","marks":["2eaf9ddf8d11"],"text":"upgrade to a paid plan","_key":"4b1accb96ba31"},{"_type":"span","marks":[],"text":" and even ","_key":"4b1accb96ba32"},{"_type":"span","marks":["41e27acbb16f"],"text":"boost your Repl","_key":"4b1accb96ba33"},{"_type":"span","marks":[],"text":".","_key":"4b1accb96ba34"}],"markDefs":[{"_key":"2eaf9ddf8d11","_type":"link","href":"https://replit.com/site/pricing"},{"_key":"41e27acbb16f","_type":"link","href":"https://blog.replit.com/boosts"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"68c21068c47c","children":[{"_type":"span","marks":[],"text":"Setting Up Config Files","_key":"68c21068c47c0"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"25d73d0ca378","children":[{"_type":"span","marks":[],"text":"In your new Repl, you should see two important files: ","_key":"25d73d0ca3780"},{"_type":"span","marks":["code"],"text":".replit","_key":"25d73d0ca3781"},{"_type":"span","marks":[],"text":" and ","_key":"25d73d0ca3782"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"25d73d0ca3783"},{"_type":"span","marks":[],"text":".","_key":"25d73d0ca3784"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4a633a608ced","children":[{"_type":"span","marks":[],"text":"The ","_key":"4a633a608ced0"},{"_type":"span","marks":["code"],"text":".replit","_key":"4a633a608ced1"},{"_type":"span","marks":[],"text":" file defines the run command (executed upon clicking ","_key":"4a633a608ced2"},{"_type":"span","marks":["strong"],"text":"Run","_key":"4a633a608ced3"},{"_type":"span","marks":[],"text":") and environment variables. For now, configure it as follows:","_key":"4a633a608ced4"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"run = \"sh start.sh\"\n\n[env]\nRAILS_ENV=\"development\"\n","_key":"d0dd8f705b3d"},{"_key":"27c5452c6789","children":[{"_type":"span","marks":[],"text":"The above config tells Replit to execute ","_key":"27c5452c67890"},{"_type":"span","marks":["code"],"text":"start.sh","_key":"27c5452c67891"},{"_type":"span","marks":[],"text":" script on the ","_key":"27c5452c67892"},{"_type":"span","marks":["strong"],"text":"Run","_key":"27c5452c67893"},{"_type":"span","marks":[],"text":" action, and sets the ","_key":"27c5452c67894"},{"_type":"span","marks":["code"],"text":"RAILS\\_ENV","_key":"27c5452c67895"},{"_type":"span","marks":[],"text":" variable used by Mastodon to ","_key":"27c5452c67896"},{"_type":"span","marks":["code"],"text":"“development”","_key":"27c5452c67897"},{"_type":"span","marks":[],"text":", which is the mode it will run in.","_key":"27c5452c67898"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d6da6f1a57da","children":[{"_type":"span","marks":[],"text":"The ","_key":"d6da6f1a57da0"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"d6da6f1a57da1"},{"_type":"span","marks":[],"text":" file configures the Nix environment, like what packages to include.","_key":"d6da6f1a57da2"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"{ pkgs }: {\n    deps = [\n        pkgs.ruby\n        pkgs.postgresql\n        pkgs.shared-mime-info\n        pkgs.nodejs\n        pkgs.yarn\n        pkgs.imagemagick\n        pkgs.ffmpeg\n        pkgs.libpqxx\n        pkgs.libxml2\n        pkgs.libxslt\n        pkgs.file\n        pkgs.git\n        pkgs.gpp\n        pkgs.protobuf\n        pkgs.pkg-config\n        pkgs.gcc\n        pkgs.autoconf\n        pkgs.bison\n        pkgs.openssl\n        pkgs.libyaml\n        pkgs.readline\n        pkgs.zlib\n        pkgs.ncurses\n        pkgs.libffi\n        pkgs.gdbm\n        pkgs.redis\n        pkgs.certbot\n        pkgs.libidn\n        pkgs.icu\n        pkgs.jemalloc\n    ];\n}\n","_key":"1317cefc1e3c"},{"_key":"0fc91b6f2f4f","children":[{"_type":"span","marks":[],"text":"The config is an anonymous function, taking ","_key":"0fc91b6f2f4f0"},{"_type":"span","marks":["code"],"text":"pkgs","_key":"0fc91b6f2f4f1"},{"_type":"span","marks":[],"text":" as a parameter and returning a list of packages to be included. Above, I already defined most of the packages required by Mastodon.","_key":"0fc91b6f2f4f2"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b6eca5e2b3c5","children":[{"_type":"span","marks":["code"],"text":"shared-mime-info","_key":"b6eca5e2b3c50"},{"_type":"span","marks":[],"text":" is a package required by one of Mastodon’s dependencies. With that said, the dependency ","_key":"b6eca5e2b3c51"},{"_type":"span","marks":["cb26f994d0bf"],"text":"can’t correctly detect the necessary package files","_key":"b6eca5e2b3c52"},{"_type":"span","marks":[],"text":". To resolve this issue, you’ll have to ","_key":"b6eca5e2b3c53"},{"_type":"span","marks":["1a2cc5a2851e"],"text":"download the required file","_key":"b6eca5e2b3c54"},{"_type":"span","marks":[],"text":" directly and place it at the root of your Repl. After that, set a ","_key":"b6eca5e2b3c55"},{"_type":"span","marks":["code"],"text":"FREEDESKTOP\\_MIME\\_TYPES\\_PATH","_key":"b6eca5e2b3c56"},{"_type":"span","marks":[],"text":" env variable in the ","_key":"b6eca5e2b3c57"},{"_type":"span","marks":["code"],"text":".replit","_key":"b6eca5e2b3c58"},{"_type":"span","marks":[],"text":" file to let the dependency know how to find it.","_key":"b6eca5e2b3c59"}],"markDefs":[{"_key":"cb26f994d0bf","_type":"link","href":"https://github.com/mimemagicrb/mimemagic/issues/160"},{"_key":"1a2cc5a2851e","_type":"link","href":"https://cgit.freedesktop.org/xdg/shared-mime-info/tree/freedesktop.org.xml.in?h=Release-1-9"}],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"[env]\nRAILS_ENV=\"development\"\nFREEDESKTOP_MIME_TYPES_PATH=\"/home/runner/${REPL_SLUG}/freedesktop.org.xml\"\n","_key":"d20217d3854f"},{"_key":"8fa1e2b37de8","children":[{"_type":"span","marks":[],"text":"Above, ","_key":"8fa1e2b37de80"},{"_type":"span","marks":["code"],"text":"REPL\\_SLUG","_key":"8fa1e2b37de81"},{"_type":"span","marks":[],"text":" is a variable identifying your Repl’s slug and therefore folder name in the file system.","_key":"8fa1e2b37de82"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"e5ab20ce670d","children":[{"_type":"span","marks":[],"text":"Installing Databases","_key":"e5ab20ce670d0"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"262e427508b6","children":[{"_type":"span","marks":[],"text":"Redis and Postgres are already included in the package list. However, to make them work properly without root access, you’ll need to configure some of their options.","_key":"262e427508b60"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"a5e14fd1819e","children":[{"_type":"span","marks":[],"text":"To run Redis, put the following command in your ","_key":"a5e14fd1819e0"},{"_type":"span","marks":["code"],"text":"start.sh","_key":"a5e14fd1819e1"},{"_type":"span","marks":[],"text":" script:","_key":"a5e14fd1819e2"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"# start Redis\nredis-cli shutdown\nredis-server --bind 127.0.0.1 &\n","_key":"61a7c32b7344"},{"_key":"6c83ed9e6ef4","children":[{"_type":"span","marks":[],"text":"The ","_key":"6c83ed9e6ef40"},{"_type":"span","marks":["code"],"text":"\\--bind","_key":"6c83ed9e6ef41"},{"_type":"span","marks":[],"text":" parameter lets the Redis server know that it should listen to the requests coming only from the selected address. This will allow Replit to proxy your future NGINX setup to its preview URL without Redis taking over.","_key":"6c83ed9e6ef42"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"be4e9fb9348f","children":[{"_type":"span","marks":[],"text":"Postgres is a bit more complicated. To set it up, first, you’ll need to create a few folders and files inside your Repl:","_key":"be4e9fb9348f0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"5ab782c0d89d","children":[{"_type":"span","marks":["code"],"text":"data","_key":"5ab782c0d89d0"},{"_type":"span","marks":[],"text":". Directory for storing Postgres databases","_key":"5ab782c0d89d1"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"39bb9f739e05","children":[{"_type":"span","marks":["code"],"text":"postgres","_key":"39bb9f739e050"},{"_type":"span","marks":[],"text":". Directory for storing Postgres socket details","_key":"39bb9f739e051"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"8ee6e5d4b4e1","children":[{"_type":"span","marks":["code"],"text":"postgresql.conf.tpl","_key":"8ee6e5d4b4e10"},{"_type":"span","marks":[],"text":". Template file for providing Postgres configuration for later use","_key":"8ee6e5d4b4e11"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"1162bc7a758f","children":[{"_type":"span","marks":[],"text":"The ","_key":"1162bc7a758f0"},{"_type":"span","marks":["code"],"text":"postgresql.conf.tpl","_key":"1162bc7a758f1"},{"_type":"span","marks":[],"text":" should look as follows:","_key":"1162bc7a758f2"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"listen_addresses = '127.0.0.1'\nport = 5432\nunix_socket_directories = 'replace_unix_dir'\n","_key":"e4122582902b"},{"_key":"8df408d04d99","children":[{"_type":"span","marks":[],"text":"In ","_key":"8df408d04d990"},{"_type":"span","marks":["code"],"text":".replit","_key":"8df408d04d991"},{"_type":"span","marks":[],"text":", define two additional env variables to point Postgres to created directories. ","_key":"8df408d04d992"},{"_type":"span","marks":["code"],"text":"PGDATA","_key":"8df408d04d993"},{"_type":"span","marks":[],"text":" sets Postgres data location, while ","_key":"8df408d04d994"},{"_type":"span","marks":["code"],"text":"DB\\_HOST","_key":"8df408d04d995"},{"_type":"span","marks":[],"text":" informs Mastodon where to look for the Postgres instance, as it’s not the default location.","_key":"8df408d04d996"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"PGDATA = \"/home/runner/${REPL_SLUG}/data\"\nDB_HOST=\"/home/runner/${REPL_SLUG}/postgres\"\n","_key":"239e65950603"},{"_key":"6d7b76444352","children":[{"_type":"span","marks":[],"text":"Finally, in the ","_key":"6d7b764443520"},{"_type":"span","marks":["code"],"text":"start.sh","_key":"6d7b764443521"},{"_type":"span","marks":[],"text":" right under Redis setup:","_key":"6d7b764443522"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"# start Postgres\npg_ctl stop\n\ninitdb -E UTF8\ncp postgresql.conf.tpl data/postgresql.conf\n\nsocker_dir=\"\\/home\\/runner\\/${REPL_SLUG}\\/postgres\"\n\nsed -i \"s/replace_unix_dir/${socker_dir}/\" data/postgresql.conf\n\npg_ctl -l /home/runner/${REPL_SLUG}/postgresql.log start\n","_key":"49026215cf75"},{"_key":"40e72b1996bc","children":[{"_type":"span","marks":[],"text":"The above script:","_key":"40e72b1996bc0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"ef25657faebb","children":[{"_type":"span","marks":[],"text":"Stops any running Postgres instances.","_key":"ef25657faebb0"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"6e82835f87f1","children":[{"_type":"span","marks":[],"text":"Initializes Postgres database with UTF8 encoding (required for Mastodon).","_key":"6e82835f87f10"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"3a4aa74235b4","children":[{"_type":"span","marks":[],"text":"Copies the configuration template to its destination.","_key":"3a4aa74235b40"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"ca58a0d881a7","children":[{"_type":"span","marks":[],"text":"Uses ","_key":"ca58a0d881a70"},{"_type":"span","marks":["code"],"text":"sed","_key":"ca58a0d881a71"},{"_type":"span","marks":[],"text":" to fill in required ","_key":"ca58a0d881a72"},{"_type":"span","marks":["code"],"text":"unix\\_socket\\_directories","_key":"ca58a0d881a73"},{"_type":"span","marks":[],"text":" value.","_key":"ca58a0d881a74"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"0a4d6edac376","children":[{"_type":"span","marks":[],"text":"Sets log file location and starts the database.","_key":"0a4d6edac3760"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"number"},{"_key":"5d98c0b0a891","children":[{"_type":"span","marks":[],"text":"With the above changes in configuration files and directories, Postgres should run in Replit without issues.","_key":"5d98c0b0a8910"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"422df6f9022e","children":[{"_type":"span","marks":[],"text":"Installing NGINX","_key":"422df6f9022e0"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"226fa76d31bf","children":[{"_type":"span","marks":[],"text":"Setting up NGINX is similar to the Postgres process. Start by creating the following files and directories:","_key":"226fa76d31bf0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"0a8548f5dad0","children":[{"_type":"span","marks":["code"],"text":"cache","_key":"0a8548f5dad00"},{"_type":"span","marks":[],"text":". Directory for storing NGINX cache files","_key":"0a8548f5dad01"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"85c4f3c39985","children":[{"_type":"span","marks":["code"],"text":"logs","_key":"85c4f3c399850"},{"_type":"span","marks":[],"text":". Directory for storing NGINX log files","_key":"85c4f3c399851"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"37d309baf00e","children":[{"_type":"span","marks":["code"],"text":"mime.types","_key":"37d309baf00e0"},{"_type":"span","marks":[],"text":". File defining MIME types used by NGINX (","_key":"37d309baf00e1"},{"_type":"span","marks":["f5589e065084"],"text":"content available in NGINX’s GitHub repo","_key":"37d309baf00e2"},{"_type":"span","marks":[],"text":")","_key":"37d309baf00e3"}],"markDefs":[{"_key":"f5589e065084","_type":"link","href":"https://github.com/nginx/nginx/blob/master/conf/mime.types"}],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"bdff0b1c62a8","children":[{"_type":"span","marks":["code"],"text":"nginx.conf","_key":"bdff0b1c62a80"},{"_type":"span","marks":[],"text":". NGINX configuration file","_key":"bdff0b1c62a81"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"f71e4c0b3e5c","children":[{"_type":"span","marks":[],"text":"In ","_key":"f71e4c0b3e5c0"},{"_type":"span","marks":["code"],"text":"nginx.conf","_key":"f71e4c0b3e5c1"},{"_type":"span","marks":[],"text":", set the logs folder to the one created before, set ","_key":"f71e4c0b3e5c2"},{"_type":"span","marks":["code"],"text":"server\\_name","_key":"f71e4c0b3e5c3"},{"_type":"span","marks":[],"text":" to match your Replit URL (fill in ","_key":"f71e4c0b3e5c4"},{"_type":"span","marks":["code"],"text":"\\[REPL\\_SLUG\\]","_key":"f71e4c0b3e5c5"},{"_type":"span","marks":[],"text":" and ","_key":"f71e4c0b3e5c6"},{"_type":"span","marks":["code"],"text":"\\[USER\\_SLUG\\]","_key":"f71e4c0b3e5c7"},{"_type":"span","marks":[],"text":" placeholders), and configure NGINX to proxy requests to host ","_key":"f71e4c0b3e5c8"},{"_type":"span","marks":["code"],"text":"0.0.0.0","_key":"f71e4c0b3e5c9"},{"_type":"span","marks":[],"text":" (required for Replit to proxy traffic) and port ","_key":"f71e4c0b3e5c10"},{"_type":"span","marks":["code"],"text":"3000","_key":"f71e4c0b3e5c11"},{"_type":"span","marks":[],"text":" (default one for Mastodon).","_key":"f71e4c0b3e5c12"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"worker_processes  1;\n\npid        /home/runner/Mastodon/logs/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    access_log  /home/runner/Mastodon/logs/access.log;\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n    server {\n        listen       8080;\n        server_name  [REPL_SLUG].[USER_SLUG].repl.co;\n\n        location / {\n            proxy_set_header Host $http_host;\n            proxy_pass   http://0.0.0.0:3000;\n        }\n    }\n\n}\n","_key":"24e07c08fbdb"},{"_key":"874c0970a178","children":[{"_type":"span","marks":[],"text":"With this done, you’ll need to get back to ","_key":"874c0970a1780"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"874c0970a1781"},{"_type":"span","marks":[],"text":" and include NGINX in the package list. However, it will require some additional configuration.","_key":"874c0970a1782"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"{ pkgs }: \nlet nginxModified = pkgs.nginx.overrideAttrs (oldAttrs: rec {\n        configureFlags = oldAttrs.configureFlags ++ [\n            \"--http-client-body-temp-path=/home/runner/Mastodon/cache/client_body\"\n            \"--http-proxy-temp-path=/home/runner/Mastodon/cache/proxy\"\n            \"--http-fastcgi-temp-path=/home/runner/Mastodon/cache/fastcgi\"\n            \"--http-uwsgi-temp-path=/home/runner/Mastodon/cache/uwsgi\"\n            \"--http-scgi-temp-path=/home/runner/Mastodon/cache/scgi\"\n         ];\n    });\n\nin {\n    deps = [\n        nginxModified\n        # ...\n    ];\n\n}\n","_key":"b02272060522"},{"_key":"ea2013f5d5bb","children":[{"_type":"span","marks":[],"text":"Your config function should now look similar to the previous code. The ","_key":"ea2013f5d5bb0"},{"_type":"span","marks":["code"],"text":"let","_key":"ea2013f5d5bb1"},{"_type":"span","marks":[],"text":" keyword defines a local ","_key":"ea2013f5d5bb2"},{"_type":"span","marks":["code"],"text":"nginxModified","_key":"ea2013f5d5bb3"},{"_type":"span","marks":[],"text":" variable containing the base NGINX package, configured with necessary flags. Other dependencies remain untouched under the ","_key":"ea2013f5d5bb4"},{"_type":"span","marks":["code"],"text":"deps","_key":"ea2013f5d5bb5"},{"_type":"span","marks":[],"text":" list.","_key":"ea2013f5d5bb6"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"be2eb137a321","children":[{"_type":"span","marks":[],"text":"Finally, in the ","_key":"be2eb137a3210"},{"_type":"span","marks":["code"],"text":"start.sh","_key":"be2eb137a3211"},{"_type":"span","marks":[],"text":"—after all database setup commands—kill any running NGINX processes and start a new one with error logs location and config file properly set.","_key":"be2eb137a3212"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"# start Nginx\npkill nginx\n\nnginx -e /home/runner/$REPL_SLUG/logs/error.log -c /home/runner/$REPL_SLUG/nginx.conf\n","_key":"cfb9c3de94bd"},{"_key":"841b44952403","children":[{"_type":"span","marks":[],"text":"Installing Mastodon","_key":"841b449524030"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"1d9d0545004b","children":[{"_type":"span","marks":[],"text":"With all the packages successfully set up, you can now download, configure, and install Mastodon. Start by downloading ","_key":"1d9d0545004b0"},{"_type":"span","marks":["a8321a95c107"],"text":"Mastodon from its GitHub repo","_key":"1d9d0545004b1"},{"_type":"span","marks":[],"text":".","_key":"1d9d0545004b2"}],"markDefs":[{"_key":"a8321a95c107","_type":"link","href":"https://github.com/mastodon/mastodon"}],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"git clone https://github.com/mastodon/mastodon.git live && cd live\ngit checkout $(git tag -l | grep -v 'rc[0-9]*$' | sort -V | tail -n 1)\n","_key":"121fb3011717"},{"_key":"f7aea7cf2854","children":[{"_type":"span","marks":[],"text":"To run the above commands, open Replit Shell (either through a visible tab or ","_key":"f7aea7cf28540"},{"_type":"span","marks":["strong"],"text":"Cmd/Ctrl + K","_key":"f7aea7cf28541"},{"_type":"span","marks":[],"text":" and typing ","_key":"f7aea7cf28542"},{"_type":"span","marks":["code"],"text":"Open Shell","_key":"f7aea7cf28543"},{"_type":"span","marks":[],"text":".","_key":"f7aea7cf28544"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"5572dae89ffb","children":[{"_type":"span","_key":"5572dae89ffb0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"6fe88f17c487","children":[{"_type":"span","marks":[],"text":"To allow access to Mastodon through Replit URL in ","_key":"6fe88f17c4870"},{"_type":"span","marks":["code"],"text":"live/config/environments/development.rb","_key":"6fe88f17c4871"},{"_type":"span","marks":[],"text":", add the following line:","_key":"6fe88f17c4872"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"Rails.application.configure do\n  # ...\n  # Allow Replit hosts\n  config.hosts << '.repl.co'\n  #...\n","_key":"c150c35d210e"},{"_key":"20a31b7e9b27","children":[{"_type":"span","marks":[],"text":"This will allow any URL ending with ","_key":"20a31b7e9b270"},{"_type":"span","marks":["code"],"text":".repl.co","_key":"20a31b7e9b271"},{"_type":"span","marks":[],"text":" to access Mastodon.","_key":"20a31b7e9b272"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"40f4b98d6432","children":[{"_type":"span","marks":[],"text":"Lastly, add the following commands to ","_key":"40f4b98d64320"},{"_type":"span","marks":["code"],"text":"start.sh","_key":"40f4b98d64321"},{"_type":"span","marks":[],"text":" to install dependencies, create a database schema, and run the Mastodon server.","_key":"40f4b98d64322"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"cd live\nbundle config with 'development'\nbundle install\nyarn install --pure-lockfile\nbundle exec rails db:setup\nbundle exec rails server & ./bin/webpack-dev-server\n","_key":"4efea8f8f9cf"},{"_key":"5891302cac30","children":[{"_type":"span","marks":[],"text":"After you click ","_key":"5891302cac300"},{"_type":"span","marks":["strong"],"text":"Run","_key":"5891302cac301"},{"_type":"span","marks":[],"text":", the script might take a while to execute. In the end, an HTTP preview should pop up, but due to ","_key":"5891302cac302"},{"_type":"span","marks":["cccaebd5720d"],"text":"Content Security Policy","_key":"5891302cac303"},{"_type":"span","marks":[],"text":" (CSP) restrictions, it won’t display any content. To get around that, click ","_key":"5891302cac304"},{"_type":"span","marks":["strong"],"text":"Open in a new tab","_key":"5891302cac305"},{"_type":"span","marks":[],"text":", and your Mastodon instance should be now up and running!","_key":"5891302cac306"}],"markDefs":[{"_key":"cccaebd5720d","_type":"link","href":"https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP"}],"_type":"block","style":"normal"},{"_key":"1554c2715131","children":[{"_type":"span","_key":"1554c27151310","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9ad20cff2e60","children":[{"_type":"span","marks":[],"text":"Conclusion","_key":"9ad20cff2e600"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"bea218752ccb","children":[{"_type":"span","marks":[],"text":"In this guide, you’ve learned how to install Mastodon in ","_key":"bea218752ccb0"},{"_type":"span","marks":["eef35238e1da"],"text":"Replit","_key":"bea218752ccb1"},{"_type":"span","marks":[],"text":"’s new Nix environment. Hopefully, this experience has shown you the potential of Replit and will inspire you to use the platform to create and run even more ambitious projects.","_key":"bea218752ccb2"}],"markDefs":[{"_key":"eef35238e1da","_type":"link","href":"https://replit.com/"}],"_type":"block","style":"normal"}],"publishedAt":"2021-11-22T00:00:00.000Z"}