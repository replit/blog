{"_id":"post-9b1bbb4b-6efd-4811-abef-42f5222e3668","_type":"post","title":"Revamping the GitHub Import Flow","slug":{"_type":"slug","current":"nix-github-imports"},"body":[{"_key":"e62947dc3daa","children":[{"_type":"span","marks":[],"text":"Early last year, we made the ","_key":"e62947dc3daa0"},{"_type":"span","marks":["731b5124c356"],"text":"announcement that our infrastructure and Repls","_key":"e62947dc3daa1"},{"_type":"span","marks":[],"text":" now had Nix baked in. Just a few months ago, we announced ","_key":"e62947dc3daa2"},{"_type":"span","marks":["f23da105f9b5"],"text":"all new Repls","_key":"e62947dc3daa3"},{"_type":"span","marks":[],"text":" would be Nix-based. And today, we're happy to announce that our GitHub imports flow is now also powered by Nix!","_key":"e62947dc3daa4"}],"markDefs":[{"_key":"731b5124c356","_type":"link","href":"https://blog.replit.com/nix"},{"_key":"f23da105f9b5","_type":"link","href":"https://blog.replit.com/powered-by-nix"}],"_type":"block","style":"normal"},{"_key":"904d2540d799","children":[{"_type":"span","marks":[],"text":"For a while now, the state of Git and GitHub integration within Replit has been a major pain point. One of the foremost problems was that while the rest of Replit jumped on the Nix train, repos imported from GitHub were still forced to use the old Bash style Repls.","_key":"904d2540d7990"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"f1e0926ef9c9","children":[{"_type":"span","marks":[],"text":"We hear you: it's frustrating not to have the ability to use our ","_key":"f1e0926ef9c90"},{"_type":"span","marks":["d30b577b76cf"],"text":"packager","_key":"f1e0926ef9c91"},{"_type":"span","marks":[],"text":" or to go through a convoluted multi-step import experience. While many other parts of Replit have been getting frequent updates and reworks, the code powering everything Git was left behind.","_key":"f1e0926ef9c92"}],"markDefs":[{"_key":"d30b577b76cf","_type":"link","href":"https://docs.replit.com/programming-ide/installing-packages"}],"_type":"block","style":"normal"},{"_key":"cebfeb177178","children":[{"_type":"span","marks":[],"text":"It was thought that this change would be a rather significant and difficult change. The longer we pushed it off, the more adamant we became that we'd need to get it done right this time.","_key":"cebfeb1771780"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"82373e513c0d","children":[{"_type":"span","marks":[],"text":"We finally decided that enough was enough - we dove deep into actually resolving this. And after some changes, we very quickly realised that the problem was not nearly as scary as we thought. After some tinkering, your GitHub imports should now be faster and more intuitive than ever!","_key":"82373e513c0d0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b650bea577f3","children":[{"_type":"span","marks":[],"text":"Here's a side-by-side comparison of the two flows:","_key":"b650bea577f30"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"3028414f7d4b","children":[{"_type":"span","_key":"3028414f7d4b0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"1ad20bef94eb","children":[{"_type":"span","marks":[],"text":"We originally thought we would have to do a significant amount of work to integrate Nix into existing language Repls. However, in reality, we realised we could actually do the opposite.","_key":"1ad20bef94eb0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b627c8bb3947","children":[{"_type":"span","marks":[],"text":"We would start with an existing Nix language template, clear out the unused files from within it that were associated with the template, then clone in the files from GitHub. In this manner, we could preserve the existing ","_key":"b627c8bb39470"},{"_type":"span","marks":["code"],"text":".replit","_key":"b627c8bb39471"},{"_type":"span","marks":[],"text":" and ","_key":"b627c8bb39472"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"b627c8bb39473"},{"_type":"span","marks":[],"text":" files that were used by each language. And we could also preserve existing environment files that were necessary for certain languages (e.g. the ","_key":"b627c8bb39474"},{"_type":"span","marks":["code"],"text":"venv","_key":"b627c8bb39475"},{"_type":"span","marks":[],"text":" folder for Python).","_key":"b627c8bb39476"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c6504ff1783c","children":[{"_type":"span","marks":[],"text":"From there, most of the existing work is already done. We then just needed a way to determine a language template to import into, which files from each template we could remove, and then finally perhaps some other small improvements to the GitHub import flow to make the user experience just a little bit nicer.","_key":"c6504ff1783c0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"1116cfcf278a","children":[{"_type":"span","marks":[],"text":"To figure out which language template to clone into, we originally considered looking into analyzing file extensions and content, but this quickly grew unfeasible as we realized the amount of edge cases that we'd have to handle.","_key":"1116cfcf278a0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d88a6a603e59","children":[{"_type":"span","marks":[],"text":"GitHub API to the rescue! The GitHub API exposes ","_key":"d88a6a603e590"},{"_type":"span","marks":["89d1f86cfcf2"],"text":"an endpoint for the languages in a repository","_key":"d88a6a603e591"},{"_type":"span","marks":[],"text":". We use this to automatically detect your repository's language to recommend the correct template.","_key":"d88a6a603e592"}],"markDefs":[{"_key":"89d1f86cfcf2","_type":"link","href":"https://docs.github.com/en/rest/repos/repos#list-repository-languages"}],"_type":"block","style":"normal"},{"_key":"8e760439bb76","children":[{"_type":"span","marks":[],"text":"Next up, figuring out which files from each template to remove. We want to make sure any Repl-specific files in our templates would be overwritten by the repositories users imported. This meant getting rid of all the boilerplate files, like ","_key":"8e760439bb760"},{"_type":"span","marks":["code"],"text":"index.html","_key":"8e760439bb761"},{"_type":"span","marks":[],"text":" in the HTML Template, and ","_key":"8e760439bb762"},{"_type":"span","marks":["code"],"text":"main.py","_key":"8e760439bb763"},{"_type":"span","marks":[],"text":" in the Python Repl.","_key":"8e760439bb764"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d2907192484a","children":[{"_type":"span","marks":[],"text":"As well, we wanted to make sure that users can work end-to-end with Replit and GitHub. This means that the experience from working in a Repl → pushing to GitHub → importing it back should be seamless. And now, it is! ","_key":"d2907192484a0"},{"_type":"span","marks":["code"],"text":".replit","_key":"d2907192484a1"},{"_type":"span","marks":[],"text":" and ","_key":"d2907192484a2"},{"_type":"span","marks":["code"],"text":"replit.nix","_key":"d2907192484a3"},{"_type":"span","marks":[],"text":" configurations pushed to the repository are always reflected in the imported Repl.","_key":"d2907192484a4"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"18409ad9bf08","children":[{"_type":"span","marks":[],"text":"Among our miscellaneous other improvements:","_key":"18409ad9bf080"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"0871a919fa06","children":[{"_type":"span","marks":[],"text":"Revamped the styling of the configuration plugin","_key":"0871a919fa060"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"ece2fa1c0902","children":[{"_type":"span","marks":[],"text":"More options to customize your run and compile commands, as well as an option to use our existing ","_key":"ece2fa1c09020"},{"_type":"span","marks":["e942b07c5843"],"text":"Prybar","_key":"ece2fa1c09021"},{"_type":"span","marks":[],"text":" interpreters","_key":"ece2fa1c09022"}],"markDefs":[{"_key":"e942b07c5843","_type":"link","href":"https://github.com/replit/prybar"}],"_type":"block","style":"normal","level":2,"listItem":"bullet"},{"_key":"f6399fe76fdd","children":[{"_type":"span","marks":[],"text":"Detecting and recommending common run commands, like ","_key":"f6399fe76fdd0"},{"_type":"span","marks":["code"],"text":"npm run start","_key":"f6399fe76fdd1"},{"_type":"span","marks":[],"text":" for Node.js projects","_key":"f6399fe76fdd2"}],"markDefs":[],"_type":"block","style":"normal","level":1,"listItem":"bullet"},{"_key":"008f4c3467d5","children":[{"_type":"span","marks":[],"text":"This brings us one step closer to fully migrating Replit from our legacy ","_key":"008f4c3467d50"},{"_type":"span","marks":["7a8b5785f20f"],"text":"Polygott","_key":"008f4c3467d51"},{"_type":"span","marks":[],"text":" backend to a new Nix world. For more updates on our progress, check out ","_key":"008f4c3467d52"},{"_type":"span","marks":["3aae875c176d"],"text":"arewenixyet.com","_key":"008f4c3467d53"},{"_type":"span","marks":[],"text":".","_key":"008f4c3467d54"}],"markDefs":[{"_key":"7a8b5785f20f","_type":"link","href":"https://github.com/replit/polygott"},{"_key":"3aae875c176d","_type":"link","href":"https://arewenixyet.com/"}],"_type":"block","style":"normal"},{"_key":"b75e2acebf0a","children":[{"_type":"span","marks":[],"text":"We hope unleashing the full power of Nix on repository imports gives users more power to fine-tune their development environment. We're excited to see what you create with this new flow!","_key":"b75e2acebf0a0"}],"markDefs":[],"_type":"block","style":"normal"}],"publishedAt":"2022-07-21T00:00:00.000Z"}