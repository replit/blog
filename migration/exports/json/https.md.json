{"_id":"post-5681a736-d03a-4f33-9a2d-9c503b2ec3cf","_type":"post","title":"HTTPS by default","slug":{"_type":"slug","current":"https"},"body":[{"_key":"9d0fda4a3759","children":[{"_type":"span","marks":[],"text":"The easiest, fastest way to put a server on the internet should also come with secure defaults. That's why we're excited to announce that Replit is now HTTPS-first, which brings additional privacy, integrity, and security benefits to servers hosted on our platform. This applies to every ","_key":"9d0fda4a37590"},{"_type":"span","marks":["6e90d9772606"],"text":"HTTP server repl","_key":"9d0fda4a37591"},{"_type":"span","marks":[],"text":" on Replit.","_key":"9d0fda4a37592"}],"markDefs":[{"_key":"6e90d9772606","_type":"link","href":"https://docs.repl.it/repls/http-servers"}],"_type":"block","style":"normal"},{"_key":"31e4754df80d","children":[{"_type":"span","_key":"31e4754df80d0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"2a892372a28d","children":[{"_type":"span","marks":[],"text":"HTTPS-first","_key":"2a892372a28d0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"4e31ff169cf9","children":[{"_type":"span","marks":[],"text":"Our hosting infrastructure makes it easy for anyone to instantly have a secure, HTTPS-secured server by default without having to lift a finger.","_key":"4e31ff169cf90"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"6fd36f7837bc","children":[{"_type":"span","marks":[],"text":"Any repl can open up a port and we'll automatically give it a publicly-accessible URL. Routing requests from the internet through to individual repls is handled by a component of our infrastructure we call the proxy.","_key":"6fd36f7837bc0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"dc0bd447c11c","children":[{"_type":"span","marks":[],"text":"On Replit, HTTPS-first means that the proxy will redirect any HTTP request to a server repl to HTTPS before it even reaches your app. Additionally, we serve ","_key":"dc0bd447c11c0"},{"_type":"span","marks":["6ff166cd17ce"],"text":"HTTP Strict Transport Security headers","_key":"dc0bd447c11c1"},{"_type":"span","marks":[],"text":" to clients to ensure that they know to make future requests over HTTPS instead of HTTP. This makes the easy path and the secure path one and the same.","_key":"dc0bd447c11c2"}],"markDefs":[{"_key":"6ff166cd17ce","_type":"link","href":"https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security"}],"_type":"block","style":"normal"},{"_key":"b5d88451b86e","children":[{"_type":"span","marks":[],"text":"How we issue certificates","_key":"b5d88451b86e0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"7c6daea52e63","children":[{"_type":"span","marks":[],"text":"Replit is responsible for around half a million HTTPS certificates. The proxy is responsible for requesting, storing, serving, and renewing these certificates using the Automatic Certificate Management Environment protocol.","_key":"7c6daea52e630"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"68bcb3d35095","children":[{"_type":"span","marks":[],"text":"ACME allows us to programatically request HTTPS certificates from certificate authorities such as ","_key":"68bcb3d350950"},{"_type":"span","marks":["33a9bd6b225d"],"text":"Let's Encrypt","_key":"68bcb3d350951"},{"_type":"span","marks":[],"text":". Essentially, ACME provides methods for us to prove to Let's Encrypt that we do in fact control the names that we're requesting certificates for. If we can do this, then Let's Encrypt will grant us certificates that are widely trusted by modern operating systems and browsers.","_key":"68bcb3d350952"}],"markDefs":[{"_key":"33a9bd6b225d","_type":"link","href":"https://letsencrypt.org"}],"_type":"block","style":"normal"},{"_key":"7adfa922a80a","children":[{"_type":"span","marks":[],"text":"Validation","_key":"7adfa922a80a0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"ad5628b650e1","children":[{"_type":"span","marks":[],"text":"We use two types of ACME validation to prove that we control the names we're responsible for: HTTP-01 and DNS-01.","_key":"ad5628b650e10"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"0369588f1555","children":[{"_type":"span","marks":[],"text":"HTTP-01","_key":"0369588f15550"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"7db9bc4e51e0","children":[{"_type":"span","marks":[],"text":"HTTP-01 validation is a straightforward way to prove that we control our names. The ACME server gives us a token, and then all we have to do is respond to that challenge by providing a specific token at a path on the domain under ","_key":"7db9bc4e51e00"},{"_type":"span","marks":["code"],"text":"/.well-known/acme-challenge/","_key":"7db9bc4e51e01"},{"_type":"span","marks":[],"text":". This is typically very quick to validate.","_key":"7db9bc4e51e02"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"2114f2d5a901","children":[{"_type":"span","marks":[],"text":"HTTP-01 is the method we use to issue certificates for ","_key":"2114f2d5a9010"},{"_type":"span","marks":["e79cfcb30373"],"text":"custom domains that serve repls","_key":"2114f2d5a9011"},{"_type":"span","marks":[],"text":". Since those domains must already have CNAME records pointing at the proxy, we can do this without requiring the domain owner to make any other changes.","_key":"2114f2d5a9012"}],"markDefs":[{"_key":"e79cfcb30373","_type":"link","href":"https://docs.repl.it/repls/web-hosting"}],"_type":"block","style":"normal"},{"_key":"9ad6d2b69ecf","children":[{"_type":"span","marks":[],"text":"DNS-01 and wildcard certificates","_key":"9ad6d2b69ecf0"}],"markDefs":[],"_type":"block","style":"h3"},{"_key":"f226dffd886b","children":[{"_type":"span","marks":[],"text":"DNS-01 validation is a more flexibile type of validation, though it requires more moving parts and is typically slower than HTTP-01 (on the order of a few dozen seconds.)","_key":"f226dffd886b0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c3bda74f1bb7","children":[{"_type":"span","marks":[],"text":"This type of validation requires that we control the DNS records for a given name. This is true for the URLs that we provide to every server on Replit, i.e. the repl.co domain.","_key":"c3bda74f1bb70"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"cf8d215c130e","children":[{"_type":"span","marks":[],"text":"DNS-01 validation also has a unique feature: we can use it to issue wildcard certificates. On Replit, we issue every user a certificate that is valid for ","_key":"cf8d215c130e0"},{"_type":"span","marks":["code"],"text":"*.<user>.repl.co","_key":"cf8d215c130e1"},{"_type":"span","marks":[],"text":". This is important because it means that we only have to issue one certificate per user regardless of how many servers they have. We only have to pay the user experience cost of requesting a new certificate the very first time that any of a user's repls receive traffic, and then any new server repls from that user can immediately use the previously-issued wildcard certificate.","_key":"cf8d215c130e2"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4da818c8e276","children":[{"_type":"span","marks":[],"text":"To do DNS-01 validation, we tell our DNS provider to set a TXT record at ","_key":"4da818c8e2760"},{"_type":"span","marks":["code"],"text":"_acme-challenge.<user>.repl.co","_key":"4da818c8e2761"},{"_type":"span","marks":[],"text":" with the value that the ACME server provides. Once we observe that our DNS provider is serving this record, we ask our ACME server to validate the challenge. If it also sees that the record has the expected value, then our certificate request is granted and we've successfully requested this user's new wildcard certificate.","_key":"4da818c8e2762"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b6ec4dca7b28","children":[{"_type":"span","marks":[],"text":"Renewals","_key":"b6ec4dca7b280"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"f7748cf89106","children":[{"_type":"span","marks":[],"text":"Our certificate authority, Let's Encrypt, issues certificates that are valid for only 90 days. This means that certificate renewal must be a very regular process for us.","_key":"f7748cf891060"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d8e8ef47f1a9","children":[{"_type":"span","marks":[],"text":"On any given day we typically renew between 5,000 and 10,000 certificates. Whenever we handle an HTTPS request, we check how much lifetime is left in the certificate. If it expires in fewer than 30 days then we'll renew the certificate using the same process that we used to issue the certificate initially.","_key":"d8e8ef47f1a90"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"a7fd17ebb6ee","children":[{"_type":"span","marks":[],"text":"To account for our ACME provider's rate limits and renewal hot spots when many certificates are issued at approximately the same time, the proxy will enter a conservation mode where it defers certificate renewals when we don't have any spare ACME orders remaining for our account. This ensures that we can still issue brand-new certificates at any given moment. Because we start trying to renew a certificate with 30 days of lifetime remaining, there's no interruption of service if we delay renewal by a few hours, days, or even weeks. We also have a circuit breaker that will ignore order conservation and always kick off a renewal if a certificate we're using is very close to expiration.","_key":"a7fd17ebb6ee0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9afc2c450720","children":[{"_type":"span","_key":"9afc2c4507200","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9a183f9a79eb","children":[{"_type":"span","marks":[],"text":"Get to building!","_key":"9a183f9a79eb0"}],"markDefs":[],"_type":"block","style":"h2"},{"_key":"f0974a14aca4","children":[{"_type":"span","marks":[],"text":"HTTPS-first is a milestone for our vision of how easy, simple, and fast web hosting should be. ","_key":"f0974a14aca40"},{"_type":"span","marks":["4c0b0878c785"],"text":"We've been iterating on hosting for almost three years","_key":"f0974a14aca41"},{"_type":"span","marks":[],"text":" and we think you'll be thrilled at ","_key":"f0974a14aca42"},{"_type":"span","marks":["dfd59b65e587"],"text":"what's in store","_key":"f0974a14aca43"},{"_type":"span","marks":[],"text":".","_key":"f0974a14aca44"}],"markDefs":[{"_key":"4c0b0878c785","_type":"link","href":"https://blog.repl.it/deploy"},{"_key":"dfd59b65e587","_type":"link","href":"https://twitter.com/amasad/status/1359553366590779399"}],"_type":"block","style":"normal"},{"_key":"7f06d9b7775c","children":[{"_type":"span","marks":[],"text":"Together with ","_key":"7f06d9b7775c0"},{"_type":"span","marks":["6c92f0b99ee6"],"text":"Always On","_key":"7f06d9b7775c1"},{"_type":"span","marks":[],"text":", ","_key":"7f06d9b7775c2"},{"_type":"span","marks":["510b91115c7f"],"text":"Database","_key":"7f06d9b7775c3"},{"_type":"span","marks":[],"text":", and ","_key":"7f06d9b7775c4"},{"_type":"span","marks":["12a1359330bd"],"text":"the huge suite of tools","_key":"7f06d9b7775c5"},{"_type":"span","marks":[],"text":" on Replit, there's no better place to build.","_key":"7f06d9b7775c6"}],"markDefs":[{"_key":"6c92f0b99ee6","_type":"link","href":"https://blog.repl.it/alwayson"},{"_key":"510b91115c7f","_type":"link","href":"https://blog.repl.it/database"},{"_key":"12a1359330bd","_type":"link","href":"https://docs.repl.it"}],"_type":"block","style":"normal"},{"_key":"955ae991e941","children":[{"_type":"span","marks":[],"text":"Thank you to the team at Let's Encrypt for the wonderful service they provide. They are essential to allowing us to deliver HTTPS to everyone on Replit.","_key":"955ae991e9410"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c9450c97a181","children":[{"_type":"span","marks":[],"text":"Happy coding! We can't wait to see what you make.","_key":"c9450c97a1810"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"6b6bece74407","children":[{"_type":"span","_key":"6b6bece744070","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"}],"publishedAt":"2021-02-26T05:00:00.000Z"}