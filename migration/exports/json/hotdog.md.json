{"_id":"post-362ab984-d686-432e-8c5e-635c421c9399","_type":"post","title":"Not Hotdog","slug":{"_type":"slug","current":"hotdog"},"body":[{"_key":"e89c0441b156","children":[{"_type":"span","marks":[],"text":"Today we're going to write a program that tells you whether an image is a hotdog or not!","_key":"e89c0441b1560"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"61972e406f69","children":[{"_type":"span","marks":[],"text":"If you didn't get the reference, here's the scene from HBO's Silicon Valley","_key":"61972e406f690"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"embed","_id":"e5c10bbe-e8a0-471b-994a-ab71560280da","url":"https://www.youtube-nocookie.com/embed/ACmydtFDTGs?rel=0","_key":"c3a1f5472e88"},{"_key":"41c268dbaf7c","children":[{"_type":"span","marks":[],"text":"Before we can start working on this, we need to ask how we can even get a computer to tell us what's in an image. The long answer is machine learning, a field of computer science that involves a lot of research and computational resources. The short answer is we'll use an API.","_key":"41c268dbaf7c0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"b4043e80aba4","children":[{"_type":"span","marks":[],"text":"There are plenty of image recognition APIs and services such as Google Cloud's Cloud Vision API or AWS' Amazon Rekognition, however, we're going to be using ","_key":"b4043e80aba40"},{"_type":"span","marks":["b7e25f704c5f"],"text":"Clarifai","_key":"b4043e80aba41"},{"_type":"span","marks":[],"text":" since we can easily use it for free with no hassle. We'll be using their API and, if you want to delve into their docs, you can find them right ","_key":"b4043e80aba42"},{"_type":"span","marks":["8ec4a9c4fb83"],"text":"here","_key":"b4043e80aba43"},{"_type":"span","marks":[],"text":". For this tutorial, I'll be sticking with the code provided in their ","_key":"b4043e80aba44"},{"_type":"span","marks":["7c9c3d6b0d62"],"text":"API Guide","_key":"b4043e80aba45"},{"_type":"span","marks":[],"text":" in the \"Images\" section.","_key":"b4043e80aba46"}],"markDefs":[{"_key":"b7e25f704c5f","_type":"link","href":"https://clarifai.com/"},{"_key":"8ec4a9c4fb83","_type":"link","href":"https://clarifai.com/developer/guide/"},{"_key":"7c9c3d6b0d62","_type":"link","href":"https://clarifai.com/developer/guide/"}],"_type":"block","style":"normal"},{"_key":"1cf7192b524b","children":[{"_type":"span","marks":[],"text":"To begin, let's start up a repl on ","_key":"1cf7192b524b0"},{"_type":"span","marks":["850e5647c3d8"],"text":"Repl.it","_key":"1cf7192b524b1"}],"markDefs":[{"_key":"850e5647c3d8","_type":"link","href":"https://repl.it"}],"_type":"block","style":"normal"},{"_key":"1b6ec54c0e5e","children":[{"_type":"span","_key":"1b6ec54c0e5e0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"fb7e6a87a781","children":[{"_type":"span","marks":[],"text":"Then, in a new tab, ","_key":"fb7e6a87a7810"},{"_type":"span","marks":["452fafc6ebe4"],"text":"create a Clarifai account","_key":"fb7e6a87a7811"},{"_type":"span","marks":[],"text":".","_key":"fb7e6a87a7812"}],"markDefs":[{"_key":"452fafc6ebe4","_type":"link","href":"https://clarifai.com/developer/account/signup"}],"_type":"block","style":"normal"},{"_key":"d5df5f8407a5","children":[{"_type":"span","_key":"d5df5f8407a50","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"9a6926ff26e0","children":[{"_type":"span","marks":[],"text":"Once you've done so, go to the ","_key":"9a6926ff26e00"},{"_type":"span","marks":["25ca3ace55ec"],"text":"application dashboard","_key":"9a6926ff26e01"},{"_type":"span","marks":[],"text":" and select \"Create New Application\"","_key":"9a6926ff26e02"}],"markDefs":[{"_key":"25ca3ace55ec","_type":"link","href":"https://clarifai.com/developer/account/applcations"}],"_type":"block","style":"normal"},{"_key":"511165b4bedf","children":[{"_type":"span","_key":"511165b4bedf0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"43bbf556314c","children":[{"_type":"span","marks":[],"text":"Put in a name for your application and get the API key for that application","_key":"43bbf556314c0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"340129aa0bfc","children":[{"_type":"span","_key":"340129aa0bfc0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"cacf48485618","children":[{"_type":"span","marks":[],"text":"That's it for stuff outside the editor, now it's time to get working!","_key":"cacf484856180"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"95f5bea74f58","children":[{"_type":"span","marks":[],"text":"In the Python repl, create an ","_key":"95f5bea74f580"},{"_type":"span","marks":["code"],"text":".env","_key":"95f5bea74f581"},{"_type":"span","marks":[],"text":" file and put in your API key like so","_key":"95f5bea74f582"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"API_KEY=afadee25a3fa4ce192d66cae17f7200b\n","_key":"6c1546ad1c37"},{"_key":"209137df9b06","children":[{"_type":"span","marks":[],"text":"We're creating a ","_key":"209137df9b060"},{"_type":"span","marks":["code"],"text":".env","_key":"209137df9b061"},{"_type":"span","marks":[],"text":" file because the ","_key":"209137df9b062"},{"_type":"span","marks":["code"],"text":".env","_key":"209137df9b063"},{"_type":"span","marks":[],"text":" file is only accessible to the owner of the repl, making it a smart location for API keys or other secrets that you wouldn't want others to have access to. It's important that you do not put the key in quotes otherwise it will not work, for more info on ","_key":"209137df9b064"},{"_type":"span","marks":["code"],"text":".env","_key":"209137df9b065"},{"_type":"span","marks":[],"text":" files in Repl.it check out ","_key":"209137df9b066"},{"_type":"span","marks":["85457b7001aa"],"text":"this post","_key":"209137df9b067"},{"_type":"span","marks":[],"text":".","_key":"209137df9b068"}],"markDefs":[{"_key":"85457b7001aa","_type":"link","href":"https://repl.it/site/docs/secret-keys"}],"_type":"block","style":"normal"},{"_key":"a1239807f93c","children":[{"_type":"span","marks":[],"text":"Next, let's create a ","_key":"a1239807f93c0"},{"_type":"span","marks":["code"],"text":"requirements.txt","_key":"a1239807f93c1"},{"_type":"span","marks":[],"text":" file for our dependencies and put the following into its contents. We'll be needing ","_key":"a1239807f93c2"},{"_type":"span","marks":["code"],"text":"dotenv","_key":"a1239807f93c3"},{"_type":"span","marks":[],"text":" so we can access the ","_key":"a1239807f93c4"},{"_type":"span","marks":["code"],"text":".env","_key":"a1239807f93c5"},{"_type":"span","marks":[],"text":" file as well as ","_key":"a1239807f93c6"},{"_type":"span","marks":["code"],"text":"clarifai","_key":"a1239807f93c7"},{"_type":"span","marks":[],"text":" to use the Clarifai API via Python","_key":"a1239807f93c8"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"dotenv\nclarifai\n","_key":"36077dd8861a"},{"_key":"00d7717d2d86","children":[{"_type":"span","marks":[],"text":"Let's start ","_key":"00d7717d2d860"},{"_type":"span","marks":["code"],"text":"main.py","_key":"00d7717d2d861"},{"_type":"span","marks":[],"text":" by grabbing the api key from our ","_key":"00d7717d2d862"},{"_type":"span","marks":["code"],"text":".env","_key":"00d7717d2d863"},{"_type":"span","marks":[],"text":" file","_key":"00d7717d2d864"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"import os\n\nAPI_KEY = os.getenv(\"API_KEY\")\n","_key":"8f55f61582ce"},{"_key":"a099d579f659","children":[{"_type":"span","marks":[],"text":"Then we follow it with the imports we need for Clarifai","_key":"a099d579f6590"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"from clarifai.rest import ClarifaiApp\nfrom clarifai.rest import Image\n","_key":"1c4fa472ec91"},{"_key":"1c2354b8d51a","children":[{"_type":"span","marks":[],"text":"Using ClarifaiApp and our API key, we create our app","_key":"1c2354b8d51a0"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"app = ClarifaiApp(api_key=API_KEY)\n","_key":"f78f8172c891"},{"_key":"fcd597f9d7aa","children":[{"_type":"span","marks":[],"text":"Next, we'll need to obtain a \"model\" for the app. The model represents the type of information to get from the image. In this case, we want to get a particular type of food so we'll use the \"food items\" model. If you're interested in the other models offered, check out Clarifai's ","_key":"fcd597f9d7aa0"},{"_type":"span","marks":["8e436df56ee7"],"text":"models page","_key":"fcd597f9d7aa1"}],"markDefs":[{"_key":"8e436df56ee7","_type":"link","href":"https://clarifai.com/models"}],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"model = app.models.get(\"food-items-v1.0\")\n","_key":"50166889d240"},{"_key":"4e31982bfe8a","children":[{"_type":"span","marks":[],"text":"As for the image I'll use a Wikipedia image of a hot dog","_key":"4e31982bfe8a0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"a791e047dfe2","children":[{"_type":"span","_key":"a791e047dfe20","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"10f96dfb43fc","children":[{"_type":"span","marks":[],"text":"And, to use it with our model, we have Clarifai's ","_key":"10f96dfb43fc0"},{"_type":"span","marks":["code"],"text":"Image","_key":"10f96dfb43fc1"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"url = \"https://upload.wikimedia.org/wikipedia/commons/thumb/b/b1/Hot_dog_with_mustard.png/1200px-Hot_dog_with_mustard.png\"\n\nimage = Image(url=url)\n","_key":"d2c16e573539"},{"_key":"21a55055bb13","children":[{"_type":"span","marks":[],"text":"Lastly, we ","_key":"21a55055bb130"},{"_type":"span","marks":["em"],"text":"predict","_key":"21a55055bb131"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"result = model.predict([image])\n","_key":"be76f7050b46"},{"_key":"6340d7ec6347","children":[{"_type":"span","marks":[],"text":"The returned ","_key":"6340d7ec63470"},{"_type":"span","marks":["code"],"text":"result","_key":"6340d7ec63471"},{"_type":"span","marks":[],"text":" is a dictionary that should look similar to this","_key":"6340d7ec63472"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"01eb9a99b3ed","children":[{"_type":"span","_key":"01eb9a99b3ed0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"3e578cbb28cd","children":[{"_type":"span","marks":[],"text":"Feel free to poke around and see what specific structures are in the object but the loop that will give us the tags Clarifai returns is","_key":"3e578cbb28cd0"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"for concept in result[\"outputs\"][0][\"data\"][\"concepts\"]:\n    print (concept[\"name\"])\n","_key":"514cb6a7515e"},{"_key":"d2caab8b4c4d","children":[{"_type":"span","marks":[],"text":"Since we only care if the displayed food is a hot dog, let's check each tag for being either \"hotdog\" or \"hot dog\"","_key":"d2caab8b4c4d0"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"hotdog = False\nfor concept in result[\"outputs\"][0][\"data\"][\"concepts\"]:\n    if concept[\"name\"] == \"hotdog\" or concept[\"name\"] == \"hot dog\":\n       hotdog = True\n       break\nif hotdog:\n   print (\"Hotdog\")\nelse:\n   print (\"Not hotdog\")\n","_key":"52def821560e"},{"_key":"5cd242b45453","children":[{"_type":"span","marks":[],"text":"And, with that, we can now determine whether or not an image is a hot dog. Go ahead and try out different urls and see it work!","_key":"5cd242b454530"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"embed","_id":"01edabd2-fb8b-416f-ac5c-96c2952e26cb","url":"https://repl.it/@yevbar/not-hotdog-simple?lite=true","_key":"6075c28f6978"},{"_key":"c2f5558b1dd2","children":[{"_type":"span","marks":[],"text":"Of course, we can do a lot better than just a script that prints \"Hot dog\" or \"Not hot dog\". If you remember from the Silicon Valley clip, they actually returned an image with the text \"Hot dog\" or \"Not hot dog\" on it. So, let's make that happen.","_key":"c2f5558b1dd20"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"e58484d11c46","children":[{"_type":"span","marks":[],"text":"To do that with Python, we'll use the Python Imaging Library (PIL). I'll be using ","_key":"e58484d11c460"},{"_type":"span","marks":["45fd7f174483"],"text":"this","_key":"e58484d11c461"},{"_type":"span","marks":[],"text":" custom font but feel free to use your own. If you use this one, you'll download a zip file with the ttf as its contents. Once you extract the ttf file or get your own, upload it to your repl","_key":"e58484d11c462"}],"markDefs":[{"_key":"45fd7f174483","_type":"link","href":"https://www.1001freefonts.com/hours.font"}],"_type":"block","style":"normal"},{"_key":"2a8d7b64c650","children":[{"_type":"span","_key":"2a8d7b64c6500","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"4c01c8bbb57b","children":[{"_type":"span","marks":[],"text":"In order to use PIL, we'll need to add ","_key":"4c01c8bbb57b0"},{"_type":"span","marks":["code"],"text":"pillow","_key":"4c01c8bbb57b1"},{"_type":"span","marks":[],"text":" to our requirements.txt","_key":"4c01c8bbb57b2"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"dotenv\nclarifai\npillow\n","_key":"f2042b96d9d9"},{"_key":"39e5261375d3","children":[{"_type":"span","marks":[],"text":"With that in, let's add the needed imports in ","_key":"39e5261375d30"},{"_type":"span","marks":["code"],"text":"app.py","_key":"39e5261375d31"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"from PIL import Image, ImageDraw, ImageFont\n","_key":"214b6f70f6c2"},{"_key":"578aa4ecbba4","children":[{"_type":"span","marks":[],"text":"Since we've been retrieving the image by a url, we don't actually have the image saved locally. However, we can use requests to obtain the image","_key":"578aa4ecbba40"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"import requests\nfrom io import BytesIO\n\nresponse = requests.get(url)\nbase = Image.open(BytesIO(response.content)).convert('RGBA')\n","_key":"5aa21476ce35"},{"_key":"d2d42cd24cd1","children":[{"_type":"span","marks":[],"text":"Since I named my ttf file ","_key":"d2d42cd24cd10"},{"_type":"span","marks":["code"],"text":"font.ttf","_key":"d2d42cd24cd11"},{"_type":"span","marks":[],"text":", we'll prepare the text like so","_key":"d2d42cd24cd12"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"size = width, height = pattern.size\ndraw = ImageDraw.Draw(pattern, \"RGBA\")\nfont = ImageFont.truetype(\"font.ttf\", 100)\n","_key":"3ab9cdf724c0"},{"_key":"798a1fe766e8","children":[{"_type":"span","marks":[],"text":"We only want to write \"Hotdog\" if it's a hotdog and \"Not hot dog\" if it isn't so we need distinguish that. I also put in some shifts in placement so that the text is more centered","_key":"798a1fe766e80"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"if hotdog:\n  draw.text((275 10),\"Hotdog\",(0, 0, 0, 255), font=font)\nelse:\n  draw.text((50, 10),\"Not hotdog\",(0, 0, 0, 255), font=font)\n","_key":"fd6153de7310"},{"_key":"9c487bbcf9e8","children":[{"_type":"span","marks":[],"text":"Since we used RGBA for coloring, we're going to have to save the file as a png","_key":"9c487bbcf9e80"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"pattern.save(\"result.png\")\n","_key":"466d78d245e8"},{"_key":"d52793963ded","children":[{"_type":"span","_key":"d52793963ded0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"61b4b5a1e94c","children":[{"_type":"span","marks":[],"text":"With that, we've put the characters from Silicon Valley to shame. However, we now need to resize the images because, if you provide a smaller image, the text will go out of view. So, proceeding the line assigning ","_key":"61b4b5a1e94c0"},{"_type":"span","marks":["code"],"text":"size","_key":"61b4b5a1e94c1"},{"_type":"span","marks":[],"text":", let's put the following","_key":"61b4b5a1e94c2"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"if size[0] < 1200:\n  base = base.resize((1200, size[1]*1200/size[0]))\nsize = width, height = base.size\n","_key":"68f9d754f096"},{"_key":"292ba7314951","children":[{"_type":"span","marks":[],"text":"The reason for the second ","_key":"292ba73149510"},{"_type":"span","marks":["code"],"text":"size","_key":"292ba73149511"},{"_type":"span","marks":[],"text":" assignment is because we may have changed the size of the image in the line before.","_key":"292ba73149512"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"0860f16291e0","children":[{"_type":"span","marks":[],"text":"Running now should resolve the issue with size. The next thing to tackle is the color of the text; if the text is white and the image is dark then we're fine but what about when they're both bright colors? To solve that, we should place the text inside a rectangle like subtitles.","_key":"0860f16291e00"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d5e0a35a035d","children":[{"_type":"span","marks":[],"text":"First, let's make the determined string \"Hotdog\" or \"Not hotdog\" be a variable","_key":"d5e0a35a035d0"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"text = \"Hotdog\" if hotdog else \"Not hotdog\"\n","_key":"2bdf286f3a7f"},{"_key":"296ec841eeb9","children":[{"_type":"span","marks":[],"text":"Next, I'm going to move the coordinates for the text into variables too","_key":"296ec841eeb90"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"x = 275 if hotdog else 50\ny = 10\n","_key":"03e42ce68e2f"},{"_key":"5b5858f74dbb","children":[{"_type":"span","marks":[],"text":"With these variables, we can get the width of the rectangle needed then draw it","_key":"5b5858f74dbb0"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"w, h = font.getsize(text)\ndraw.rectangle((x, y, x + w, y + h), fill='white')\n","_key":"efc815d3413b"},{"_key":"9f26ab286365","children":[{"_type":"span","marks":[],"text":"Now we should always be able to read the text. As one final thing, let's make the background of the text green or red based on whether or not it's a hotdog","_key":"9f26ab2863650"}],"markDefs":[],"_type":"block","style":"normal"},{"_type":"codeBlock","language":"text","codeContent":"draw.rectange((x, y, x + w, y + h), fill=\"green\" if hotdog else \"red\")\n","_key":"67d3ed9e3e07"},{"_key":"7b5e4485834d","children":[{"_type":"span","_key":"7b5e4485834d0","text":"","marks":[]}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"d6ad1f7bafda","children":[{"_type":"span","marks":[],"text":"As you can see, a hamster is not a hot dog and you made \"Not hotdog\" using Python!","_key":"d6ad1f7bafda0"}],"markDefs":[],"_type":"block","style":"normal"},{"_key":"c974519ba61a","children":[{"_type":"span","marks":[],"text":"As always if you have any questions or want to say hi, feel to send me an email at ","_key":"c974519ba61a0"},{"_type":"span","marks":["15d076db8ee9"],"text":"yev@repl.it","_key":"c974519ba61a1"},{"_type":"span","marks":[],"text":" and till next time!","_key":"c974519ba61a2"}],"markDefs":[{"_key":"15d076db8ee9","_type":"link","href":"mailto:yev@repl.it"}],"_type":"block","style":"normal"}],"publishedAt":"2018-07-19T17:00:36.000Z"}